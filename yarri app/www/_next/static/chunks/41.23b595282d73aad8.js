"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41],{4043:function(e,t,n){n.d(t,{Z:function(){return r}});var o=n(2898);let r=(0,o.Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},4671:function(e,t,n){n.d(t,{X:function(){return o}});let o={appId:"5296c3e4d4b2432f8cf42a9f8e2041e5"}},5997:function(e,t,n){n.r(t),n.d(t,{SocketProvider:function(){return SocketProvider},useSocket:function(){return useSocket}});var o=n(7437),r=n(2265),l=n(4337);let i=(0,r.createContext)({socket:null,isConnected:!1,incomingCall:null,setIncomingCall:()=>{}}),useSocket=()=>(0,r.useContext)(i);function SocketProvider(e){let{children:t}=e,[n,a]=(0,r.useState)(null),[c,s]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e="https://admin.yaari.me";console.log("\uD83D\uDD0C Attempting to connect to Socket.io server:",e);let t=(0,l.io)(e,{transports:["websocket","polling"],timeout:2e4,forceNew:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5});return t.on("connect",()=>{console.log("✅ Socket connected successfully"),s(!0);let e=localStorage.getItem("user");if(e)try{let n=JSON.parse(e);console.log("\uD83D\uDC64 Registering user:",n.id),t.emit("register",n.id),t.emit("user-online",{userId:n.id,status:"online"}),t.emit("get-online-users")}catch(e){console.error("❌ Error parsing user data:",e)}}),t.on("connect_error",e=>{console.error("❌ Socket connection error:",e),s(!1)}),t.on("disconnect",e=>{console.log("\uD83D\uDD0C Socket disconnected:",e),s(!1)}),t.on("reconnect",e=>{console.log("\uD83D\uDD04 Socket reconnected after",e,"attempts"),s(!0);let n=localStorage.getItem("user");if(n)try{let e=JSON.parse(n);t.emit("register",e.id),t.emit("user-online",{userId:e.id,status:"online"}),t.emit("get-online-users")}catch(e){console.error("❌ Error parsing user data:",e)}}),t.on("reconnect_error",e=>{console.error("❌ Socket reconnection error:",e)}),t.on("incoming-call",e=>{let{callerId:t,callerName:n,callType:o,channelName:r}=e;console.log("\uD83D\uDCE5 Incoming call (global):",{callerId:t,callerName:n,callType:o,channelName:r}),p({callerId:t,callerName:n,callType:o,channelName:r})}),t.on("call-accepted",e=>{let{channelName:t,callType:n}=e;console.log("✅ Call accepted (global):",{channelName:t,callType:n});try{t&&sessionStorage.setItem("channelName",t);let e=sessionStorage.getItem("callData"),o=n||"audio";if(e)try{let t=JSON.parse(e);((null==t?void 0:t.type)==="video"||(null==t?void 0:t.type)==="audio")&&(o=t.type)}catch(e){}else n&&sessionStorage.setItem("callData",JSON.stringify({userName:"",userAvatar:"",rate:"video"===n?10:5,type:n,channelName:t,otherUserId:""}));let r="video"===o?"/video-call":"/audio-call";window.location.href=r}catch(e){console.error("Error handling global call-accepted:",e)}}),t.on("call-busy",e=>{let{message:t}=e;console.log("\uD83D\uDCF5 Call busy:",t),alert(t)}),t.on("call-ended",()=>{console.log("\uD83D\uDED1 Call ended (global) — clearing incomingCall"),p(null)}),a(t),()=>{console.log("\uD83E\uDDF9 Cleaning up socket connection"),t.off("incoming-call"),t.off("call-accepted"),t.off("call-busy"),t.off("call-ended"),t.off("connect"),t.off("connect_error"),t.off("disconnect"),t.off("reconnect"),t.off("reconnect_error"),t.disconnect()}},[]),(0,o.jsx)(i.Provider,{value:{socket:n,isConnected:c,incomingCall:u,setIncomingCall:p},children:t})}},5376:function(e,t,n){n.d(t,{K:function(){return useBackButton}});var o=n(2265),r=n(4033),l=n(3103);let i=(0,l.fo)("App",{web:()=>n.e(762).then(n.bind(n,6762)).then(e=>new e.AppWeb)});function useBackButton(e){let t=(0,r.useRouter)();(0,o.useEffect)(()=>{if(!l.dV.isNativePlatform())return;let n=null,setupListener=async()=>{n=await i.addListener("backButton",n=>{let{canGoBack:o}=n;console.log("Back button pressed, canGoBack:",o),e?e():o?t.back():i.exitApp()})};return setupListener(),()=>{n&&n.remove()}},[e,t])}},4064:function(e,t,n){var o=n(3103);let r=o.dV.isNativePlatform()?(0,o.fo)("AudioRouting"):{enterCommunicationMode:async()=>({status:"noop"}),setSpeakerphoneOn:async()=>({status:"noop",speakerOn:!1}),resetAudio:async()=>({status:"noop"})};t.Z=r},5128:function(e,t,n){n.d(t,{H4:function(){return trackAppOpen},L9:function(){return trackEvent},Lj:function(){return updateUserProfile},QU:function(){return trackUserLogin},Tf:function(){return trackSubscription},YY:function(){return trackProfileView},o$:function(){return trackScreenView}});var o=n(1007),r=n(3103),l=n(4725);let isNativeCleverTapReady=()=>{try{return r.dV.isNativePlatform()&&"function"==typeof(null===o.z||void 0===o.z?void 0:o.z.notifyDeviceReady)&&"function"==typeof(null===o.z||void 0===o.z?void 0:o.z.recordEventWithName)}catch(e){return!1}};(()=>{let e=!isNativeCleverTapReady();if(!e)return;let t=window;if(t.clevertap)return;t.clevertap={event:[],profile:[],account:[],onUserLogin:[],region:"eu1"},t.clevertap.account.push({id:"775-RZ7-W67Z"});let n=document.createElement("script");n.src="https://static.clevertap.com/js/clevertap.min.js",n.type="text/javascript",n.async=!0,n.onload=()=>console.log("CleverTap Web SDK loaded"),n.onerror=e=>console.error("CleverTap Web SDK load failed:",e);let o=document.getElementsByTagName("script")[0];((null==o?void 0:o.parentNode)||document.head).insertBefore(n,o||null)})(),(0,l.BP)();let isCleverTapAvailable=()=>isNativeCleverTapReady(),formatPhoneE164=e=>{if(!e)return;let t=String(e).trim();if(t.startsWith("+"))return t;let n=t.replace(/[^0-9]/g,"");return 10===n.length?"+91".concat(n):12===n.length&&n.startsWith("91")?"+".concat(n):void 0},updateUserProfile=async e=>{let t={...e},n=formatPhoneE164(e.Phone);n?t.Phone=n:delete t.Phone,t["MSG-push"]=!0,t["MSG-email"]=!0,t["MSG-sms"]=!0;try{(0,l.Bq)(t)}catch(e){}if(isCleverTapAvailable())try{await o.z.profileSet(t),console.log("✅ CleverTap profile updated:",t)}catch(e){console.log("CleverTap profileSet error:",e)}else try{var r,i;null===(i=window.clevertap)||void 0===i||null===(r=i.profile)||void 0===r||r.push({Site:t}),console.log("✅ Web CleverTap profile updated:",t)}catch(e){console.log("Web CleverTap profile push error:",e)}},trackUserLogin=async(e,t)=>{let n={Identity:e,...t||{}},r=formatPhoneE164(n.Phone);r?n.Phone=r:delete n.Phone,n["MSG-push"]=!0,n["MSG-email"]=!0,n["MSG-sms"]=!0;try{(0,l.xU)(e),n&&(0,l.Bq)(n)}catch(e){}if(isCleverTapAvailable())try{let r=o.z.onUserLogin(n),l=new Promise((e,t)=>{setTimeout(()=>t(Error("CleverTap login timeout")),5e3)});await Promise.race([r,l]),console.log("✅ CleverTap user login tracked:",e),await updateUserProfile(t||{})}catch(e){console.log("CleverTap onUserLogin error:",e)}else try{var i,a;null===(a=window.clevertap)||void 0===a||null===(i=a.onUserLogin)||void 0===i||i.push({Site:n}),console.log("✅ Web CleverTap user login tracked:",e),await updateUserProfile(t||{})}catch(e){console.log("Web CleverTap onUserLogin error:",e)}},trackEvent=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n={...t,timestamp:new Date().toISOString(),platform:r.dV.isNativePlatform()?"mobile":"web"},i=new Promise((t,r)=>{try{if(isCleverTapAvailable())n&&Object.keys(n).length>0?o.z.recordEventWithNameAndProps(e,n):o.z.recordEventWithName(e);else{var l,i,a,c;n&&Object.keys(n).length>0?null===(i=window.clevertap)||void 0===i||null===(l=i.event)||void 0===l||l.push(e,n):null===(c=window.clevertap)||void 0===c||null===(a=c.event)||void 0===a||a.push(e)}t()}catch(e){r(e)}}),a=new Promise((e,t)=>{setTimeout(()=>t(Error("CleverTap event timeout")),3e3)});await Promise.race([i,a]),(0,l.WO)(e,n),console.log("✅ Event tracked: ".concat(e),n)}catch(e){console.error("Error tracking event:",e)}},trackProfileView=async e=>{await trackEvent("Profile Viewed",{"Viewed User ID":e})},trackSubscription=async(e,t,n)=>{await trackEvent("Subscription Purchased",{"Plan Name":e,Amount:t,Currency:n})},trackAppOpen=async()=>{try{(0,l.WO)("App Open")}catch(e){}if(isCleverTapAvailable())try{await o.z.notifyDeviceReady(),await o.z.recordEventWithName("App Open")}catch(e){console.log("CleverTap notifyDeviceReady/App Open error:",e)}else try{var e,t;null===(t=window.clevertap)||void 0===t||null===(e=t.event)||void 0===e||e.push("App Open")}catch(e){console.log("Web CleverTap App Open error:",e)}},trackScreenView=async e=>{await trackEvent("Screen View",{"Screen Name":e})}},2273:function(e,t,n){n.d(t,{G:function(){return deductCoins}});let deductCoins=async(e,t,n)=>{try{let o=await fetch("https://admin.yaari.me/api/users/".concat(e,"/deduct-coins"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({coins:t,callType:n})}),r=await o.json();if(!o.ok)throw Error(r.error||"Failed to deduct coins");return r}catch(e){throw console.error("Coin deduction error:",e),e}}},4725:function(e,t,n){n.d(t,{BP:function(){return initMixpanel},Bq:function(){return mixpanelPeopleSet},WO:function(){return mixpanelTrack},xU:function(){return mixpanelIdentify}});var o=n(718);let r=!1,getToken=()=>{let e="b19e0189e8c34fe2a980f09ba1ceeedc";return e&&e.trim().length>0?e.trim():"b19e0189e8c34fe2a980f09ba1ceeedc"},initMixpanel=e=>{if(r)return;let t=e||getToken();if(!t){console.warn("Mixpanel token missing. Set NEXT_PUBLIC_MIXPANEL_TOKEN in .env.local");return}o.Z.init(t,{debug:!0,track_pageview:!1}),r=!0,console.log("Mixpanel initialized")},mixpanelTrack=(e,t)=>{try{if(initMixpanel(),!r)return;t&&Object.keys(t).length>0?o.Z.track(e,t):o.Z.track(e)}catch(e){console.log("Mixpanel track error:",e)}},mixpanelIdentify=e=>{try{if(initMixpanel(),!r)return;o.Z.identify(e)}catch(e){console.log("Mixpanel identify error:",e)}},normalizePeopleProps=e=>{var t,n,o;let r={...e},l=null!==(t=e.Name)&&void 0!==t?t:e.name,i=null!==(n=e.Email)&&void 0!==n?n:e.email,a=null!==(o=e.Phone)&&void 0!==o?o:e.phone;return l&&(r.$name=String(l),delete r.Name,delete r.name),i&&(r.$email=String(i),delete r.Email,delete r.email),a&&(r.$phone=String(a),delete r.Phone,delete r.phone),r},mixpanelPeopleSet=e=>{try{if(initMixpanel(),!r)return;let t=normalizePeopleProps(e);o.Z.people.set(t)}catch(e){console.log("Mixpanel people.set error:",e)}}}}]);