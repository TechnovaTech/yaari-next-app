(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return createLucideIcon}});var a=r(2265),l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),createLucideIcon=(e,t)=>{let r=(0,a.forwardRef)(({color:r="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:i,children:n,...d},c)=>(0,a.createElement)("svg",{ref:c,...l,width:o,height:o,stroke:r,strokeWidth:i?24*Number(s)/Number(o):s,className:`lucide lucide-${toKebabCase(e)}`,...d},[...t.map(([e,t])=>(0,a.createElement)(e,t)),...(Array.isArray(n)?n:[n])||[]]));return r.displayName=`${e}`,r}},1291:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2898);let l=(0,a.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7972:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2898);let l=(0,a.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2549:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2898);let l=(0,a.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8577:function(e,t,r){Promise.resolve().then(r.bind(r,596))},596:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return EditProfilePage}});var a=r(7437),l=r(4033),o=r(1291),s=r(7972),i=r(2549),n=r(2898);let d=(0,n.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var c=r(2265),u=r(3487),p=r(5650),g=r(5128);function EditProfileScreen(e){let{onBack:t}=e,{lang:r}=(0,u.useLanguage)(),l=p.I[r],[n,f]=(0,c.useState)(""),[h,m]=(0,c.useState)(""),[y,b]=(0,c.useState)(""),[x,v]=(0,c.useState)(""),[j,P]=(0,c.useState)([]),[w,N]=(0,c.useState)(""),[S,k]=(0,c.useState)([]),[E,C]=(0,c.useState)(!1),[U,I]=(0,c.useState)(""),[T,A]=(0,c.useState)(""),[F,L]=(0,c.useState)("en"),buildApiUrl=e=>{let t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;return t?"/api".concat(e):"".concat("https://admin.yaari.me","/api").concat(e)},fetchUserImages=async e=>{try{let t=await fetch(buildApiUrl("/users/".concat(e,"/images")));if(!t.ok)return console.error("Failed to fetch user images:",t.status,t.statusText),{profilePic:"",gallery:[]};{let e=await t.json(),r=e.profilePic||"";r&&r.includes("localhost")&&(r=r.replace(/https?:\/\/0\.0\.0\.0:\d+/,"https://admin.yaari.me"));let a=(e.gallery||[]).map(e=>e.includes("localhost")?e.replace(/https?:\/\/0\.0\.0\.0:\d+/,"https://admin.yaari.me"):e);return{profilePic:r,gallery:a}}}catch(e){return console.error("Error fetching user images:",e),{profilePic:"",gallery:[]}}};(0,c.useEffect)(()=>{(0,g.o$)("Edit Profile");let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);f(t.name||""),m(t.phone||""),b(t.email||""),v(t.about||""),P(t.hobbies||[]),I(t.gender||""),L(t.language||"en"),t.id?fetchUserImages(t.id).then(e=>{A(e.profilePic),k(e.gallery)}):(A(t.profilePic||""),k(t.gallery||[]))}},[]);let addHobby=()=>{w.trim()&&(P([...j,w.trim()]),N(""))},removeHobby=e=>{P(j.filter((t,r)=>r!==e))},uploadPhotoToDatabase=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let r=JSON.parse(localStorage.getItem("user")||"{}"),a=null==r?void 0:r.id;if(!a)return console.error("User ID missing while uploading photo:",r),alert("User session invalid. Please log in again."),null;let l=new FormData;l.append("photo",e),l.append("userId",String(a)),l.append("isProfilePic",t.toString());let o=await fetch(buildApiUrl("/upload-photo"),{method:"POST",body:l});if(!o.ok)return console.error("Photo upload failed:",o.status,o.statusText),null;{let e=await o.json();return e.photoUrl}}catch(e){return console.error("Error uploading photo:",e),null}},uploadMultiplePhotos=async e=>{let t=e.map(e=>uploadPhotoToDatabase(e,!1)),r=await Promise.all(t);return r.filter(e=>null!==e)},deletePhotoFromDatabase=async e=>{try{let t=JSON.parse(localStorage.getItem("user")||"{}"),r=await fetch(buildApiUrl("/delete-photo"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,photoUrl:e})});if(r.ok)return!0;return console.error("Photo deletion failed:",r.status,r.statusText),!1}catch(e){return console.error("Error deleting photo:",e),!1}};return(0,a.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 pt-8",children:[(0,a.jsx)("button",{onClick:t,children:(0,a.jsx)(o.Z,{size:24,className:"text-gray-800"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>L("en"),className:"px-4 py-2 rounded-full text-sm font-semibold ".concat("en"===F?"bg-primary text-white":"bg-gray-200 text-gray-700"),children:"EN"}),(0,a.jsx)("button",{onClick:()=>L("hi"),className:"px-4 py-2 rounded-full text-sm font-semibold ".concat("hi"===F?"bg-primary text-white":"bg-gray-200 text-gray-700"),children:"HI"})]})]}),(0,a.jsx)("div",{className:"px-4 pb-6",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-black",children:l.editProfile})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 px-4 mb-8",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:T&&"loading"!==T?(0,a.jsx)("img",{src:T,alt:"Profile",className:"w-full h-full object-cover"}):"loading"===T?(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:"Uploading..."}):(0,a.jsx)(s.Z,{size:48,className:"text-gray-500"})}),(0,a.jsx)("input",{type:"file",id:"profilePic",accept:"image/*",className:"hidden",onChange:async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){A("loading");try{let e=await uploadPhotoToDatabase(r,!0);e?(A(e),alert("Profile picture uploaded successfully!")):(alert("Failed to upload profile picture. Please try again."),A(""))}catch(e){console.error("Profile picture upload error:",e),alert("Error uploading profile picture. Please try again."),A("")}}}}),(0,a.jsx)("label",{htmlFor:"profilePic",className:"px-6 py-3 border-2 border-primary text-primary rounded-full font-semibold cursor-pointer flex items-center justify-center",children:l.uploadPicture})]}),(0,a.jsxs)("div",{className:"px-4 mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Gender"}),(0,a.jsx)("div",{className:"w-full p-4 border border-gray-300 rounded-full text-base bg-gray-100 text-gray-700 capitalize",children:U||"Not set"})]}),(0,a.jsxs)("div",{className:"px-4 space-y-6 pb-24",children:[(0,a.jsx)("input",{type:"text",value:n,onChange:e=>f(e.target.value),placeholder:"User Name",className:"w-full p-4 border border-gray-300 rounded-full text-base focus:outline-none focus:border-primary bg-gray-50",style:{fontSize:"16px"}}),(0,a.jsx)("input",{type:"tel",value:h,onChange:e=>m(e.target.value),placeholder:"Phone Number",disabled:!!h,className:"w-full p-4 border border-gray-300 rounded-full text-base focus:outline-none focus:border-primary bg-gray-50 disabled:bg-gray-200 disabled:cursor-not-allowed",style:{fontSize:"16px"}}),(0,a.jsx)("input",{type:"email",value:y,onChange:e=>b(e.target.value),placeholder:"Email Address",disabled:!!y,className:"w-full p-4 border border-gray-300 rounded-full text-base focus:outline-none focus:border-primary bg-gray-50 disabled:bg-gray-200 disabled:cursor-not-allowed",style:{fontSize:"16px"}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:l.aboutMe}),(0,a.jsx)("textarea",{value:x,onChange:e=>v(e.target.value),placeholder:"Tell us about yourself...",rows:4,className:"w-full p-4 border border-gray-300 rounded-2xl text-base focus:outline-none focus:border-primary bg-gray-50 resize-none",style:{fontSize:"16px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:l.photoGallery}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[S.map((e,t)=>(0,a.jsx)("div",{className:"aspect-square bg-gray-200 rounded-lg relative overflow-hidden",children:"loading"===e?(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-500",children:"Uploading..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:e,alt:"Gallery ".concat(t),className:"w-full h-full object-cover"}),(0,a.jsx)("button",{onClick:async()=>{k(S.filter((e,r)=>r!==t));let r=await deletePhotoFromDatabase(e);r||(k(t=>[...t,e]),alert("Failed to delete photo from database. Please try again."))},className:"absolute top-1 right-1 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(i.Z,{size:14,className:"text-white"})})]})},t)),(0,a.jsx)("input",{type:"file",id:"galleryPic",accept:"image/*",multiple:!0,className:"hidden",onChange:async e=>{let t=Array.from(e.target.files||[]);if(t.length>0){try{let e=Array(t.length).fill("loading");k([...S,...e]);let r=await uploadMultiplePhotos(t);k(e=>{let t=e.filter(e=>"loading"!==e);return[...t,...r]}),r.length>0?alert("".concat(r.length," photo(s) uploaded successfully!")):alert("Failed to upload photos. Please try again.")}catch(e){console.error("Gallery photos upload error:",e),alert("Error uploading photos. Please try again."),k(e=>e.filter(e=>"loading"!==e))}e.target.value=""}}}),(0,a.jsx)("label",{htmlFor:"galleryPic",className:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center cursor-pointer",children:(0,a.jsx)(d,{size:24,className:"text-gray-400"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:l.hobbies}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:j.map((e,t)=>(0,a.jsxs)("span",{className:"bg-orange-50 text-gray-800 px-4 py-2 rounded-full text-sm border border-gray-200 flex items-center gap-2",children:[e,(0,a.jsx)("button",{onClick:()=>removeHobby(t),children:(0,a.jsx)(i.Z,{size:14,className:"text-gray-600"})})]},t))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:w,onChange:e=>N(e.target.value),onKeyPress:e=>"Enter"===e.key&&addHobby(),placeholder:"Add a hobby",className:"flex-1 p-3 border border-gray-300 rounded-full text-sm focus:outline-none focus:border-primary bg-gray-50",style:{fontSize:"16px"}}),(0,a.jsx)("button",{onClick:addHobby,className:"px-4 py-3 bg-primary text-white rounded-full font-semibold text-sm whitespace-nowrap flex items-center justify-center",children:l.add})]})]})]}),(0,a.jsx)("div",{className:"fixed bottom-8 left-4 right-4",children:(0,a.jsx)("button",{onClick:async()=>{if(!n.trim()){alert("Please enter your name");return}C(!0),(0,g.L9)("ProfileSaveAttempt");try{let e;let t=JSON.parse(localStorage.getItem("user")||"{}");if(!t.id){console.error("User ID not found in localStorage:",t),alert("User session invalid. Please log in again.");return}let r={name:n,phone:h,email:y,about:x,hobbies:j,language:F};console.log("Saving profile for user ID:",t.id),console.log("Payload:",r);let a=await fetch(buildApiUrl("/users/".concat(t.id)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});console.log("API Response Status:",a.status,a.statusText);try{e=await a.json(),console.log("Save response:",e)}catch(t){console.error("Failed to parse response JSON:",t),e={error:"Invalid server response"}}if(a.ok){let e={...t,name:n,phone:h,email:y,about:x,hobbies:j,language:F,profilePic:T,gallery:S};localStorage.setItem("user",JSON.stringify(e)),(0,g.Lj)({Name:n,Email:y,Phone:h,Gender:U,About:x,Hobbies:j.join(", "),"Profile Picture":T}).catch(e=>{console.warn("CleverTap profile update failed:",e)}),(0,g.L9)("ProfileSaved"),alert("Profile saved successfully!"),setTimeout(()=>{window.location.href="/users"},0)}else{let t=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"HTTP ".concat(a.status,": ").concat(a.statusText);console.error("API Error:",t,"Full response:",e),(0,g.L9)("ProfileSaveFailed",{error:t,status:a.status}),alert("Failed to save profile: ".concat(t))}}catch(t){console.error("Profile save error:",t),(0,g.L9)("ProfileSaveError",{error:(null==t?void 0:t.message)||"Unknown error"});let e=(null==t?void 0:t.message)||(null==t?void 0:t.toString())||"";e.includes("Failed to fetch")||e.includes("NetworkError")?alert("Network error. Please check your internet connection and try again."):e.includes("413")||e.includes("Payload Too Large")?alert("Photos are too large. Please try with smaller images or fewer photos."):e.includes("timeout")?alert("Upload timeout. Please try with fewer or smaller photos."):alert("Error saving profile. Please try again.")}finally{C(!1)}},disabled:E,className:"w-full bg-primary text-white py-4 rounded-full font-semibold text-lg disabled:opacity-50 flex items-center justify-center",children:E?"Saving...":l.saveChanges})})]})}function EditProfilePage(){let e=(0,l.useRouter)();return(0,a.jsx)(EditProfileScreen,{onBack:()=>e.back()})}}},function(e){e.O(0,[601,623,617,971,472,744],function(){return e(e.s=8577)}),_N_E=e.O()}]);