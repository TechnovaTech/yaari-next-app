(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return createLucideIcon}});var a=r(2265),l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),createLucideIcon=(e,t)=>{let r=(0,a.forwardRef)(({color:r="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:i,children:n,...c},d)=>(0,a.createElement)("svg",{ref:d,...l,width:o,height:o,stroke:r,strokeWidth:i?24*Number(s)/Number(o):s,className:`lucide lucide-${toKebabCase(e)}`,...c},[...t.map(([e,t])=>(0,a.createElement)(e,t)),...(Array.isArray(n)?n:[n])||[]]));return r.displayName=`${e}`,r}},1291:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2898);let l=(0,a.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7972:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2898);let l=(0,a.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2549:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2898);let l=(0,a.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5073:function(e,t,r){Promise.resolve().then(r.bind(r,691))},691:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return EditProfilePage}});var a=r(7437),l=r(4033),o=r(1291),s=r(7972),i=r(2898);let n=(0,i.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),c=(0,i.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var d=r(2549),u=r(2265),p=r(3103),g=r(3487),m=r(5650),h=r(5128);function EditProfileScreen(e){let{onBack:t}=e,{lang:r}=(0,g.useLanguage)(),l=m.I[r],[i,f]=(0,u.useState)(""),[y,b]=(0,u.useState)(""),[x,v]=(0,u.useState)(""),[w,j]=(0,u.useState)(""),[P,N]=(0,u.useState)([]),[S,k]=(0,u.useState)(""),[C,U]=(0,u.useState)([]),[E,I]=(0,u.useState)(new Set),[T,A]=(0,u.useState)(new Set),[L,z]=(0,u.useState)(!1),[F,D]=(0,u.useState)(""),[O,Z]=(0,u.useState)(""),[H,K]=(0,u.useState)("en"),canonicalUrlKey=e=>{try{let t=e.match(/\/uploads\/([^?#]+)/);return t&&t[1]?t[1].toLowerCase():e.toLowerCase()}catch(t){return e.toLowerCase()}},normalizeUrlHost=e=>{var t;return null==e?void 0:null===(t=e.replace(/https?:\/\/localhost:\d+/g,"https://admin.yaari.me"))||void 0===t?void 0:t.replace(/https?:\/\/0\.0\.0\.0:\d+/g,"https://admin.yaari.me")},dedupeByCanonical=e=>{let t=new Map;for(let r of e){let e=normalizeUrlHost(r),a=canonicalUrlKey(e);t.has(a)||t.set(a,e)}return Array.from(t.values())},M="https://admin.yaari.me",buildApiUrl=e=>{let t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,r=p.dV.isNativePlatform();return!t||r?"".concat(M,"/api").concat(e):"/api".concat(e)},fetchUserImages=async e=>{try{let t=await fetch(buildApiUrl("/users/".concat(e,"/images")));if(t.ok){let e=await t.json(),r=e.profilePic||"";r&&(r=r.replace(/https?:\/\/(0\.0\.0\.0|localhost):\d+/g,"https://admin.yaari.me"));let a=(e.gallery||[]).filter(e=>e&&"string"==typeof e&&e.trim()).map(e=>e.replace(/https?:\/\/(0\.0\.0\.0|localhost):\d+/g,"https://admin.yaari.me"));return{profilePic:r,gallery:a}}return{profilePic:"",gallery:[]}}catch(e){return console.error("Error fetching user images:",e),{profilePic:"",gallery:[]}}},refreshGalleryState=async e=>{let t=await fetchUserImages(e),r=dedupeByCanonical(t.gallery).filter(e=>e&&e.trim()).filter(e=>!E.has(canonicalUrlKey(e)));try{let e=await Promise.all(r.map(e=>new Promise(t=>{try{let r=new Image,a=setTimeout(()=>t(null),5e3);r.onload=()=>{clearTimeout(a),t(e)},r.onerror=()=>{clearTimeout(a),t(null)},r.src=e}catch(e){t(null)}}))),a=e.filter(e=>!!e);Z(t.profilePic),U(dedupeByCanonical(a))}catch(e){Z(t.profilePic),U(dedupeByCanonical(r))}};(0,u.useEffect)(()=>{(0,h.o$)("Edit Profile");let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);f(t.name||""),b(t.phone||""),v(t.email||""),j(t.about||""),N(t.hobbies||[]),D(t.gender||""),K(t.language||"en"),t.id?refreshGalleryState(t.id):(Z(t.profilePic||""),U(dedupeByCanonical((t.gallery||[]).filter(e=>e&&e.trim()))))}},[]);let addHobby=()=>{S.trim()&&(N([...P,S.trim()]),k(""))},removeHobby=e=>{N(P.filter((t,r)=>r!==e))},compressImage=async e=>new Promise(t=>{let r=new FileReader;r.onload=r=>{var a;let l=new Image;l.onload=()=>{let r=document.createElement("canvas"),a=l.width,o=l.height;a>o&&a>1200?(o=1200*o/a,a=1200):o>1200&&(a=1200*a/o,o=1200),r.width=a,r.height=o;let s=r.getContext("2d");s.drawImage(l,0,0,a,o),r.toBlob(r=>{t(new File([r],e.name,{type:"image/jpeg"}))},"image/jpeg",.8)},l.src=null===(a=r.target)||void 0===a?void 0:a.result},r.readAsDataURL(e)}),uploadPhotoToDatabase=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let a=JSON.parse(localStorage.getItem("user")||"{}"),l=null==a?void 0:a.id;if(!l)return console.error("User ID missing while uploading photo:",a),alert("User session invalid. Please log in again."),null;let o=await compressImage(e),s=new FormData;s.append("photo",o),s.append("userId",String(l)),s.append("isProfilePic",t.toString());let i=await fetch(buildApiUrl("/upload-photo"),{method:"POST",body:s});if(!i.ok)return console.error("Photo upload failed:",i.status,i.statusText),null;{var r;let e=await i.json(),t=(null===(r=e.photoUrl)||void 0===r?void 0:r.replace(/https?:\/\/(0\.0\.0\.0|localhost):\d+/g,"https://admin.yaari.me"))||e.photoUrl;return t}}catch(e){return console.error("Error uploading photo:",e),null}},uploadMultiplePhotos=async e=>{let t=e.map(e=>uploadPhotoToDatabase(e,!1)),r=await Promise.all(t);return r.filter(e=>null!==e)},deletePhotoFromDatabase=async e=>{try{let t=JSON.parse(localStorage.getItem("user")||"{}");if(!t.id)return!1;let r=e.replace(/https?:\/\/(0\.0\.0\.0|localhost):\d+/g,M),a=await fetch(buildApiUrl("/delete-photo"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,photoUrl:e,normalizedPhotoUrl:r})});return a.ok}catch(e){return console.error("Delete error:",e),!1}};return(0,a.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 pt-8",children:[(0,a.jsx)("button",{onClick:t,children:(0,a.jsx)(o.Z,{size:24,className:"text-gray-800"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>K("en"),className:"px-4 py-2 rounded-full text-sm font-semibold ".concat("en"===H?"bg-primary text-white":"bg-gray-200 text-gray-700"),children:"EN"}),(0,a.jsx)("button",{onClick:()=>K("hi"),className:"px-4 py-2 rounded-full text-sm font-semibold ".concat("hi"===H?"bg-primary text-white":"bg-gray-200 text-gray-700"),children:"HI"})]})]}),(0,a.jsx)("div",{className:"px-4 pb-6",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-black",children:l.editProfile})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 px-4 mb-8",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:O&&"loading"!==O?(0,a.jsx)("img",{src:O,alt:"Profile",className:"w-full h-full object-cover"}):"loading"===O?(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:"Uploading..."}):(0,a.jsx)(s.Z,{size:48,className:"text-gray-500"})}),(0,a.jsx)("input",{type:"file",id:"profilePic",accept:"image/*",className:"hidden",onChange:async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){Z("loading");try{let e=await uploadPhotoToDatabase(r,!0);e?(Z(e),alert("Profile picture uploaded successfully!")):(alert("Failed to upload profile picture. Please try again."),Z(""))}catch(e){console.error("Profile picture upload error:",e),alert("Error uploading profile picture. Please try again."),Z("")}}}}),(0,a.jsx)("label",{htmlFor:"profilePic",className:"px-6 py-3 border-2 border-primary text-primary rounded-full font-semibold cursor-pointer flex items-center justify-center",children:l.uploadPicture})]}),(0,a.jsxs)("div",{className:"px-4 mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Gender"}),(0,a.jsx)("div",{className:"w-full p-4 border border-gray-300 rounded-full text-base bg-gray-100 text-gray-700 capitalize",children:F||"Not set"})]}),(0,a.jsxs)("div",{className:"px-4 space-y-6 pb-24",children:[(0,a.jsx)("input",{type:"text",value:i,onChange:e=>f(e.target.value),placeholder:"User Name",className:"w-full p-4 border border-gray-300 rounded-full text-base focus:outline-none focus:border-primary bg-gray-50",style:{fontSize:"16px"}}),(0,a.jsx)("input",{type:"tel",value:y,onChange:e=>b(e.target.value),placeholder:"Phone Number",disabled:!!y,className:"w-full p-4 border border-gray-300 rounded-full text-base focus:outline-none focus:border-primary bg-gray-50 disabled:bg-gray-200 disabled:cursor-not-allowed",style:{fontSize:"16px"}}),(0,a.jsx)("input",{type:"email",value:x,onChange:e=>v(e.target.value),placeholder:"Email Address",disabled:!!x,className:"w-full p-4 border border-gray-300 rounded-full text-base focus:outline-none focus:border-primary bg-gray-50 disabled:bg-gray-200 disabled:cursor-not-allowed",style:{fontSize:"16px"}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:l.aboutMe}),(0,a.jsx)("textarea",{value:w,onChange:e=>j(e.target.value),placeholder:"Tell us about yourself...",rows:4,className:"w-full p-4 border border-gray-300 rounded-2xl text-base focus:outline-none focus:border-primary bg-gray-50 resize-none",style:{fontSize:"16px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:l.photoGallery}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[C.filter(e=>e&&"loading"!==e).map((e,t)=>(0,a.jsxs)("div",{className:"aspect-square bg-gray-200 rounded-lg relative overflow-hidden",children:[(0,a.jsx)("img",{src:e,alt:"",className:"w-full h-full object-cover",onError:()=>{let t=canonicalUrlKey(e);I(e=>new Set(e).add(t)),U(e=>dedupeByCanonical(e.filter(e=>canonicalUrlKey(e)!==t)))}}),(0,a.jsx)("button",{onClick:async()=>{if(!confirm("Delete this photo?"))return;let t=canonicalUrlKey(e);A(e=>new Set(e).add(t)),I(e=>new Set(e).add(t)),U(e=>{let r=dedupeByCanonical(e.filter(e=>canonicalUrlKey(e)!==t));try{let e=JSON.parse(localStorage.getItem("user")||"{}");if(e&&e.id){let t={...e,gallery:r};localStorage.setItem("user",JSON.stringify(t))}}catch(e){}return r});let r=await deletePhotoFromDatabase(e);r||alert("Failed to delete photo. Please refresh the page."),A(e=>{let r=new Set(e);return r.delete(t),r})},className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center shadow-lg",children:(0,a.jsx)(n,{size:16,className:"text-white"})})]},canonicalUrlKey(e))),C.filter(e=>"loading"===e).map((e,t)=>(0,a.jsx)("div",{className:"aspect-square bg-gray-200 rounded-lg flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Uploading..."})},"loading-".concat(t))),(0,a.jsx)("input",{type:"file",id:"galleryPic",accept:"image/*",multiple:!0,className:"hidden",onChange:async e=>{let t=Array.from(e.target.files||[]);if(t.length>0){try{let e=Array(t.length).fill("loading");U([...C,...e]);let r=await uploadMultiplePhotos(t);U(e=>{let t=e.filter(e=>"loading"!==e);return[...t,...r]}),r.length>0?alert("".concat(r.length," photo(s) uploaded successfully!")):alert("Failed to upload photos. Please try again.")}catch(e){console.error("Gallery photos upload error:",e),alert("Error uploading photos. Please try again."),U(e=>e.filter(e=>"loading"!==e))}e.target.value=""}}}),(0,a.jsx)("label",{htmlFor:"galleryPic",className:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center cursor-pointer",children:(0,a.jsx)(c,{size:24,className:"text-gray-400"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:l.hobbies}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:P.map((e,t)=>(0,a.jsxs)("span",{className:"bg-orange-50 text-gray-800 px-4 py-2 rounded-full text-sm border border-gray-200 flex items-center gap-2",children:[e,(0,a.jsx)("button",{onClick:()=>removeHobby(t),children:(0,a.jsx)(d.Z,{size:14,className:"text-gray-600"})})]},t))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:S,onChange:e=>k(e.target.value),onKeyPress:e=>"Enter"===e.key&&addHobby(),placeholder:"Add a hobby",className:"flex-1 p-3 border border-gray-300 rounded-full text-sm focus:outline-none focus:border-primary bg-gray-50",style:{fontSize:"16px"}}),(0,a.jsx)("button",{onClick:addHobby,className:"px-4 py-3 bg-primary text-white rounded-full font-semibold text-sm whitespace-nowrap flex items-center justify-center",children:l.add})]})]})]}),(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white p-4 shadow-lg safe-bottom",children:(0,a.jsx)("button",{onClick:async()=>{if(!i.trim()){alert("Please enter your name");return}z(!0),(0,h.L9)("ProfileSaveAttempt");try{let e;let t=JSON.parse(localStorage.getItem("user")||"{}");if(!t.id){console.error("User ID not found in localStorage:",t),alert("User session invalid. Please log in again.");return}let r={name:i,phone:y,email:x,about:w,hobbies:P,language:H};console.log("Saving profile for user ID:",t.id),console.log("Payload:",r);let a=await fetch(buildApiUrl("/users/".concat(t.id)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});console.log("API Response Status:",a.status,a.statusText);try{e=await a.json(),console.log("Save response:",e)}catch(t){console.error("Failed to parse response JSON:",t),e={error:"Invalid server response"}}if(a.ok){let e={...t,name:i,phone:y,email:x,about:w,hobbies:P,language:H,profilePic:O,gallery:C};localStorage.setItem("user",JSON.stringify(e)),(0,h.Lj)({Name:i,Email:x,Phone:y,Gender:F,About:w,Hobbies:P.join(", "),"Profile Picture":O}).catch(e=>{console.warn("CleverTap profile update failed:",e)}),(0,h.L9)("ProfileSaved"),alert("Profile saved successfully!"),setTimeout(()=>{window.location.href="/users"},0)}else{let t=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"HTTP ".concat(a.status,": ").concat(a.statusText);console.error("API Error:",t,"Full response:",e),(0,h.L9)("ProfileSaveFailed",{error:t,status:a.status}),alert("Failed to save profile: ".concat(t))}}catch(t){console.error("Profile save error:",t),(0,h.L9)("ProfileSaveError",{error:(null==t?void 0:t.message)||"Unknown error"});let e=(null==t?void 0:t.message)||(null==t?void 0:t.toString())||"";e.includes("Failed to fetch")||e.includes("NetworkError")?alert("Network error. Please check your internet connection and try again."):e.includes("413")||e.includes("Payload Too Large")?alert("Photos are too large. Please try with smaller images or fewer photos."):e.includes("timeout")?alert("Upload timeout. Please try with fewer or smaller photos."):alert("Error saving profile. Please try again.")}finally{z(!1)}},disabled:L,className:"w-full bg-primary text-white py-4 rounded-full font-semibold text-lg disabled:opacity-50 flex items-center justify-center",children:L?"Saving...":l.saveChanges})})]})}function EditProfilePage(){let e=(0,l.useRouter)();return(0,a.jsx)(EditProfileScreen,{onBack:()=>e.back()})}}},function(e){e.O(0,[601,623,617,971,472,744],function(){return e(e.s=5073)}),_N_E=e.O()}]);