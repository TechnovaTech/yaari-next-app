(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[252],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return createLucideIcon}});var n=r(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),createLucideIcon=(e,t)=>{let r=(0,n.forwardRef)(({color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:s,children:l,...c},d)=>(0,n.createElement)("svg",{ref:d,...a,width:o,height:o,stroke:r,strokeWidth:s?24*Number(i)/Number(o):i,className:`lucide lucide-${toKebabCase(e)}`,...c},[...t.map(([e,t])=>(0,n.createElement)(e,t)),...(Array.isArray(l)?l:[l])||[]]));return r.displayName=`${e}`,r}},3067:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(2898);let a=(0,n.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3634:function(e,t,r){Promise.resolve().then(r.bind(r,2081))},2081:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CoinsPage}});var n=r(7437),a=r(4033),o=r(3067),i=r(2265),s=r(5128);function CoinPurchaseScreen(e){let{onBack:t}=e,[r,a]=(0,i.useState)(0),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(null),[m,p]=(0,i.useState)(""),[f,h]=(0,i.useState)(1),[x,y]=(0,i.useState)(null),[g,b]=(0,i.useState)(null),[w,v]=(0,i.useState)(!1),[j,k]=(0,i.useState)(!1),N="https://acsgroup.cloud";(0,i.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);fetchBalance(t.id)}loadSettings(),loadPlans(),(0,s.o$)("Coin Purchase")},[]);let loadSettings=async()=>{try{let r=await fetch("".concat(N,"/api/settings")),n=await r.json();if(r.ok){var e,t;h(n.coinsPerRupee||1),y(null!==(e=n.minRecharge)&&void 0!==e?e:null),b(null!==(t=n.maxRecharge)&&void 0!==t?t:null)}}catch(e){console.error("Error loading settings:",e)}},loadPlans=async()=>{try{let e=await fetch("".concat(N,"/api/plans")),t=await e.json();if(e.ok){let e=(t||[]).filter(e=>!1!==e.isActive).sort((e,t)=>{var r,n;return(null!==(r=e.price)&&void 0!==r?r:0)-(null!==(n=t.price)&&void 0!==n?n:0)});c(e)}}catch(e){console.error("Error loading plans:",e)}},fetchBalance=async e=>{try{let t=await fetch("".concat(N,"/api/users/").concat(e,"/balance")),r=await t.json();if(t.ok){a(r.balance||0);let e=JSON.parse(localStorage.getItem("user")||"{}");e.balance=r.balance,localStorage.setItem("user",JSON.stringify(e))}}catch(e){console.error("Error fetching balance:",e)}},P=(()=>{let e=Number(m);return e&&f?Number((e/f).toFixed(2)):0})(),S=x&&f?Math.ceil(x*f):void 0,_=g&&f?Math.floor(g*f):void 0,C=!d&&(!!x&&P>0&&P<(x||0)||!!g&&P>(g||1/0)),loadRazorpayScript=()=>new Promise(e=>{if(window.Razorpay)return e(!0);let t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>e(!0),t.onerror=()=>e(!1),document.body.appendChild(t)}),proceedPayment=async()=>{let e,t;let n=localStorage.getItem("user");if(!n){alert("Please login to continue");return}let o=JSON.parse(n),i=0,l="topup";if(d)i=d.price,l="plan",e=d._id;else{let e=Number(m);if(!e||e<=0){alert("Enter number of coins or select a plan");return}if(t=e,i=P,null!==x&&i<x){alert("Minimum recharge is Rs ".concat(x));return}if(null!==g&&i>g){alert("Maximum recharge is Rs ".concat(g));return}}v(!0);try{let n=await loadRazorpayScript();if(!n){alert("Failed to load Razorpay");return}let c=await fetch("".concat(N,"/api/payments/order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.id,amountRupees:i,type:l,planId:e,coins:t})}),u=await c.json();if(!c.ok){alert(u.error||"Order creation failed");return}(0,s.L9)("Payment Initiated",{Amount:i,Type:l,"Plan ID":e||"Custom",Coins:d?d.coins:t,"Payment Method":"Razorpay"});let m={key:u.keyId||"rzp_test_RUT2Cmr6oeKa0b",amount:u.amountPaise,currency:u.currency||"INR",name:"Yaari",description:d?d.title||"Coin Plan":"Top-up ".concat(t," coins"),order_id:u.orderId,handler:async function(n){try{let o=await fetch("".concat(N,"/api/payments/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:n.razorpay_order_id,paymentId:n.razorpay_payment_id,signature:n.razorpay_signature})}),c=await o.json();o.ok?(alert("Payment successful! Coins credited."),a(c.newBalance||r),(0,s.L9)("Payment Successful",{Amount:i,Type:l,"Plan ID":e||"Custom",Coins:d?d.coins:t,"Payment ID":n.razorpay_payment_id,"Order ID":n.razorpay_order_id}),d&&e&&(0,s.Tf)(d.title||"Coin Plan",i,"INR")):(alert(c.error||"Payment verification failed"),(0,s.L9)("Payment Failed",{Amount:i,Type:l,Error:c.error||"Verification failed"}))}catch(e){alert("Payment verification error"),(0,s.L9)("Payment Error",{Amount:i,Type:l,Error:"Verification error"})}},theme:{color:"#FF6B35"},prefill:{name:o.name||"Yaari User",contact:o.phone||""}},p=new window.Razorpay(m);p.open()}catch(e){console.error("Payment error:",e),alert("Something went wrong while initiating payment")}finally{v(!1)}};return(0,n.jsx)("div",{className:"min-h-screen bg-white",style:{fontFamily:"var(--font-baloo)"},children:(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("button",{onClick:t,className:"mb-6",children:(0,n.jsx)(o.Z,{size:24,className:"text-gray-700"})}),(0,n.jsxs)("div",{className:"bg-orange-50 rounded-2xl p-6 mb-4 flex items-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-orange-400 rounded-full flex items-center justify-center mr-4",children:(0,n.jsx)("span",{className:"text-white text-3xl font-extrabold",children:"Y"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-gray-700 text-sm mb-1",children:"Total Coin Balance"}),(0,n.jsxs)("p",{className:"text-3xl font-extrabold",children:[r," coin"]})]})]}),(0,n.jsx)("div",{className:"border-t border-gray-300 my-6"}),(0,n.jsx)("h2",{className:"text-orange-500 font-semibold text-lg mb-4",children:"Add More Coins"}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2 text-xs text-gray-500",children:[(0,n.jsxs)("span",{children:["Coins per Rupee: ",f]}),(0,n.jsxs)("span",{children:["Min Rs ",null!=x?x:"-"," â€¢ Max Rs ",null!=g?g:"-"]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2 bg-gray-50 p-3 rounded-lg",children:[(0,n.jsx)("input",{type:"number",value:m,onChange:e=>p(e.target.value),placeholder:"Enter no of coins",className:"flex-1 bg-transparent outline-none text-sm",min:null!=S?S:void 0,max:null!=_?_:void 0}),(0,n.jsxs)("span",{className:"text-gray-600 text-sm",children:["Rs ",P]})]}),C&&(0,n.jsxs)("div",{className:"mb-4 text-xs text-red-600",children:[x&&P<x&&(0,n.jsxs)("span",{children:["Minimum recharge is Rs ",x,"."]}),g&&P>g&&(0,n.jsxs)("span",{children:[" Maximum recharge is Rs ",g,"."]})]}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:l.map((e,t)=>(0,n.jsxs)("button",{onClick:()=>u(e),className:"rounded-3xl p-4 md:p-5 bg-rose-50 hover:bg-rose-100 transition-all border border-gray-200 shadow-md flex flex-col justify-between ".concat((null==d?void 0:d._id)===e._id?"ring-2 ring-orange-500":""),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[j?(0,n.jsx)("div",{className:"w-9 h-9 md:w-10 md:h-10 rounded-full bg-gradient-to-br from-yellow-300 to-orange-400 shadow-inner flex items-center justify-center shrink-0",children:(0,n.jsx)("span",{className:"text-yellow-900 font-extrabold text-[10px]",children:"Y"})}):(0,n.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-9 h-9 md:w-10 md:h-10 object-contain shrink-0",onError:()=>k(!0)}),(0,n.jsx)("span",{className:"inline-flex items-center h-9 md:h-10 text-xl md:text-2xl font-extrabold text-black leading-none",children:e.coins})]}),(0,n.jsxs)("div",{className:"mt-4 flex flex-col items-center",children:[(0,n.jsxs)("p",{className:"text-base md:text-lg font-extrabold text-black",children:["Rs",e.price]}),e.originalPrice&&e.originalPrice>e.price?(0,n.jsxs)("p",{className:"text-xs md:text-sm text-gray-400 line-through mt-1",children:["Rs",e.originalPrice]}):null]})]},e._id||t))}),(0,n.jsx)("button",{onClick:proceedPayment,disabled:w||C,className:"w-full bg-orange-500 text-white py-4 rounded-2xl font-semibold text-base hover:bg-orange-600 transition-colors flex items-center justify-center disabled:opacity-60",children:w?"Processing...":"Proceed to Payment"})]})})}function CoinsPage(){let e=(0,a.useRouter)();return(0,n.jsx)(CoinPurchaseScreen,{onBack:()=>e.back()})}},5128:function(e,t,r){"use strict";r.d(t,{L9:function(){return trackEvent},QU:function(){return trackUserLogin},Tf:function(){return trackSubscription},YY:function(){return trackProfileView},o$:function(){return trackScreenView}});let trackUserLogin=async(e,t)=>{console.log("trackUserLogin (CleverTap disabled):",e,t)},trackEvent=async(e,t)=>{console.log("trackEvent (CleverTap disabled):",e,t)},trackProfileView=async e=>{console.log("trackProfileView (CleverTap disabled):",e)},trackSubscription=async(e,t,r)=>{console.log("trackSubscription (CleverTap disabled):",e,t,r)},trackScreenView=async e=>{console.log("trackScreenView (CleverTap disabled):",e)}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),a=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var n,l={},c=null,d=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,n)&&!s.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===l[n]&&(l[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:d,props:l,_owner:i.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=3634)}),_N_E=e.O()}]);