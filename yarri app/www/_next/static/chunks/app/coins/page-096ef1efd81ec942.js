(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[252],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return createLucideIcon}});var n=r(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),createLucideIcon=(e,t)=>{let r=(0,n.forwardRef)(({color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:l,children:c,...s},d)=>(0,n.createElement)("svg",{ref:d,...a,width:o,height:o,stroke:r,strokeWidth:l?24*Number(i)/Number(o):i,className:`lucide lucide-${toKebabCase(e)}`,...s},[...t.map(([e,t])=>(0,n.createElement)(e,t)),...(Array.isArray(c)?c:[c])||[]]));return r.displayName=`${e}`,r}},3067:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(2898);let a=(0,n.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3634:function(e,t,r){Promise.resolve().then(r.bind(r,2081))},2081:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CoinsPage}});var n=r(7437),a=r(4033),o=r(3067),i=r(2265),l=r(5128);function CoinPurchaseScreen(e){let{onBack:t}=e,[r,a]=(0,i.useState)(0),[c,s]=(0,i.useState)([]),[d,u]=(0,i.useState)(null),[p,m]=(0,i.useState)(""),[f,h]=(0,i.useState)(1),[y,v]=(0,i.useState)(null),[g,x]=(0,i.useState)(null),[b,w]=(0,i.useState)(!1),[P,N]=(0,i.useState)(!1),k="https://admin.yaari.me";(0,i.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);fetchBalance(t.id)}loadSettings(),loadPlans(),(0,l.o$)("Coin Purchase")},[]);let loadSettings=async()=>{try{let r=await fetch("".concat(k,"/api/settings")),n=await r.json();if(r.ok){var e,t;h(n.coinsPerRupee||1),v(null!==(e=n.minRecharge)&&void 0!==e?e:null),x(null!==(t=n.maxRecharge)&&void 0!==t?t:null)}}catch(e){console.error("Error loading settings:",e)}},loadPlans=async()=>{try{let e=await fetch("".concat(k,"/api/plans")),t=await e.json();if(e.ok){let e=(t||[]).filter(e=>!1!==e.isActive).sort((e,t)=>{var r,n;return(null!==(r=e.price)&&void 0!==r?r:0)-(null!==(n=t.price)&&void 0!==n?n:0)});s(e)}}catch(e){console.error("Error loading plans:",e)}},fetchBalance=async e=>{try{let t=await fetch("".concat(k,"/api/users/").concat(e,"/balance")),r=await t.json();if(t.ok){a(r.balance||0);let e=JSON.parse(localStorage.getItem("user")||"{}");e.balance=r.balance,localStorage.setItem("user",JSON.stringify(e))}}catch(e){console.error("Error fetching balance:",e)}},S=(()=>{let e=Number(p);return e&&f?Number((e/f).toFixed(2)):0})(),j=y&&f?Math.ceil(y*f):void 0,C=g&&f?Math.floor(g*f):void 0,T=!d&&(!!y&&S>0&&S<(y||0)||!!g&&S>(g||1/0)),loadRazorpayScript=()=>new Promise(e=>{if(window.Razorpay)return e(!0);let t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>e(!0),t.onerror=()=>e(!1),document.body.appendChild(t)}),proceedPayment=async()=>{let e,t;let n=localStorage.getItem("user");if(!n){alert("Please login to continue");return}let o=JSON.parse(n),i=0,c="topup";if(d)i=d.price,c="plan",e=d._id;else{let e=Number(p);if(!e||e<=0){alert("Enter number of coins or select a plan");return}if(t=e,i=S,null!==y&&i<y){alert("Minimum recharge is Rs ".concat(y));return}if(null!==g&&i>g){alert("Maximum recharge is Rs ".concat(g));return}}w(!0);try{let n=await loadRazorpayScript();if(!n){alert("Failed to load Razorpay");return}let s=await fetch("".concat(k,"/api/payments/order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.id,amountRupees:i,type:c,planId:e,coins:t})}),u=await s.json();if(!s.ok){alert(u.error||"Order creation failed");return}(0,l.L9)("Payment Initiated",{Amount:i,Type:c,"Plan ID":e||"Custom",Coins:d?d.coins:t,"Payment Method":"Razorpay"});let p={key:u.keyId||"rzp_test_RUT2Cmr6oeKa0b",amount:u.amountPaise,currency:u.currency||"INR",name:"Yaari",description:d?d.title||"Coin Plan":"Top-up ".concat(t," coins"),order_id:u.orderId,handler:async function(n){try{let o=await fetch("".concat(k,"/api/payments/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:n.razorpay_order_id,paymentId:n.razorpay_payment_id,signature:n.razorpay_signature})}),s=await o.json();o.ok?(alert("Payment successful! Coins credited."),a(s.newBalance||r),(0,l.L9)("Payment Successful",{Amount:i,Type:c,"Plan ID":e||"Custom",Coins:d?d.coins:t,"Payment ID":n.razorpay_payment_id,"Order ID":n.razorpay_order_id}),d&&e&&(0,l.Tf)(d.title||"Coin Plan",i,"INR")):(alert(s.error||"Payment verification failed"),(0,l.L9)("Payment Failed",{Amount:i,Type:c,Error:s.error||"Verification failed"}))}catch(e){alert("Payment verification error"),(0,l.L9)("Payment Error",{Amount:i,Type:c,Error:"Verification error"})}},theme:{color:"#FF6B35"},prefill:{name:o.name||"Yaari User",contact:o.phone||""}},m=new window.Razorpay(p);m.open()}catch(e){console.error("Payment error:",e),alert("Something went wrong while initiating payment")}finally{w(!1)}};return(0,n.jsx)("div",{className:"min-h-screen bg-white",style:{fontFamily:"var(--font-baloo)"},children:(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("button",{onClick:t,className:"mb-6",children:(0,n.jsx)(o.Z,{size:24,className:"text-gray-700"})}),(0,n.jsxs)("div",{className:"bg-orange-100 rounded-2xl p-6 mb-4 flex items-center",children:[P?(0,n.jsx)("div",{className:"w-16 h-16 bg-orange-400 rounded-full flex items-center justify-center mr-4",children:(0,n.jsx)("span",{className:"text-white text-3xl font-extrabold mt-5",children:"Y"})}):(0,n.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-16 h-16 object-contain mr-4",onError:()=>N(!0)}),(0,n.jsxs)("div",{className:"mt-2.5",children:[(0,n.jsx)("p",{className:"text-gray-700 text-sm mb-1",children:"Total Coin Balance"}),(0,n.jsxs)("p",{className:"text-3xl font-extrabold",children:[r," coin"]})]})]}),(0,n.jsx)("div",{className:"border-t-2 border-gray-400 my-6"}),(0,n.jsx)("h2",{className:"text-orange-500 font-semibold text-lg mb-4",children:"Add More Coins"}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2 bg-gray-50 p-3 rounded-lg",children:[(0,n.jsx)("input",{type:"number",value:p,onChange:e=>m(e.target.value),placeholder:"Enter no of coins",className:"flex-1 bg-transparent outline-none text-sm",min:null!=j?j:void 0,max:null!=C?C:void 0}),(0,n.jsxs)("span",{className:"text-gray-600 text-sm",children:["Rs ",S]})]}),T&&(0,n.jsxs)("div",{className:"mb-4 text-xs text-red-600",children:[y&&S<y&&(0,n.jsxs)("span",{children:["Minimum recharge is Rs ",y,"."]}),g&&S>g&&(0,n.jsxs)("span",{children:[" Maximum recharge is Rs ",g,"."]})]}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:c.map((e,t)=>(0,n.jsxs)("button",{onClick:()=>u(e),className:"rounded-3xl p-4 md:p-5 bg-rose-100 border border-gray-200 shadow-md flex flex-col justify-between ".concat((null==d?void 0:d._id)===e._id?"ring-2 ring-orange-500":""),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[P?(0,n.jsx)("div",{className:"w-9 h-9 md:w-10 md:h-10 rounded-full bg-gradient-to-br from-yellow-300 to-orange-400 shadow-inner flex items-center justify-center shrink-0",children:(0,n.jsx)("span",{className:"text-yellow-900 font-extrabold text-[10px]",children:"Y"})}):(0,n.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-9 h-9 md:w-10 md:h-10 object-contain shrink-0",onError:()=>N(!0)}),(0,n.jsx)("span",{className:"inline-flex items-center h-9 md:h-10 text-xl md:text-2xl font-extrabold text-black leading-none mt-2.5",children:e.coins})]}),(0,n.jsxs)("div",{className:"mt-4 flex flex-col items-center",children:[(0,n.jsxs)("p",{className:"text-base md:text-lg font-extrabold text-black",children:["Rs ",e.price]}),e.originalPrice&&e.originalPrice>e.price?(0,n.jsxs)("p",{className:"text-xs md:text-sm text-gray-400 line-through mt-1",children:["Rs ",e.originalPrice]}):null]})]},e._id||t))}),(0,n.jsx)("button",{onClick:proceedPayment,disabled:b||T,className:"w-full bg-orange-500 text-white py-4 rounded-2xl font-semibold text-base flex items-center justify-center disabled:opacity-60",children:(0,n.jsx)("span",{style:{marginTop:"10px"},children:b?"Processing...":"Proceed to Payment"})})]})})}function CoinsPage(){let e=(0,a.useRouter)();return(0,n.jsx)(CoinPurchaseScreen,{onBack:()=>e.back()})}},5128:function(e,t,r){"use strict";r.d(t,{H4:function(){return trackAppOpen},L9:function(){return trackEvent},Lj:function(){return updateUserProfile},QU:function(){return trackUserLogin},Tf:function(){return trackSubscription},YY:function(){return trackProfileView},o$:function(){return trackScreenView}});var n=r(1007),a=r(3103),o=r(4725);let isNativeCleverTapReady=()=>{try{return a.dV.isNativePlatform()&&"function"==typeof(null===n.z||void 0===n.z?void 0:n.z.notifyDeviceReady)&&"function"==typeof(null===n.z||void 0===n.z?void 0:n.z.recordEventWithName)}catch(e){return!1}};(()=>{let e=!isNativeCleverTapReady();if(!e)return;let t=window;if(t.clevertap)return;t.clevertap={event:[],profile:[],account:[],onUserLogin:[],region:"eu1"},t.clevertap.account.push({id:"775-RZ7-W67Z"});let r=document.createElement("script");r.src="https://static.clevertap.com/js/clevertap.min.js",r.type="text/javascript",r.async=!0,r.onload=()=>console.log("CleverTap Web SDK loaded"),r.onerror=e=>console.error("CleverTap Web SDK load failed:",e);let n=document.getElementsByTagName("script")[0];((null==n?void 0:n.parentNode)||document.head).insertBefore(r,n||null)})(),(0,o.BP)();let isCleverTapAvailable=()=>isNativeCleverTapReady(),formatPhoneE164=e=>{if(!e)return;let t=String(e).trim();if(t.startsWith("+"))return t;let r=t.replace(/[^0-9]/g,"");return 10===r.length?"+91".concat(r):12===r.length&&r.startsWith("91")?"+".concat(r):void 0},updateUserProfile=async e=>{let t={...e},r=formatPhoneE164(e.Phone);r?t.Phone=r:delete t.Phone,t["MSG-push"]=!0,t["MSG-email"]=!0,t["MSG-sms"]=!0;try{(0,o.Bq)(t)}catch(e){}if(isCleverTapAvailable())try{await n.z.profileSet(t),console.log("✅ CleverTap profile updated:",t)}catch(e){console.log("CleverTap profileSet error:",e)}else try{var a,i;null===(i=window.clevertap)||void 0===i||null===(a=i.profile)||void 0===a||a.push({Site:t}),console.log("✅ Web CleverTap profile updated:",t)}catch(e){console.log("Web CleverTap profile push error:",e)}},trackUserLogin=async(e,t)=>{let r={Identity:e,...t||{}},a=formatPhoneE164(r.Phone);a?r.Phone=a:delete r.Phone,r["MSG-push"]=!0,r["MSG-email"]=!0,r["MSG-sms"]=!0;try{(0,o.xU)(e),r&&(0,o.Bq)(r)}catch(e){}if(isCleverTapAvailable())try{let a=n.z.onUserLogin(r),o=new Promise((e,t)=>{setTimeout(()=>t(Error("CleverTap login timeout")),5e3)});await Promise.race([a,o]),console.log("✅ CleverTap user login tracked:",e),await updateUserProfile(t||{})}catch(e){console.log("CleverTap onUserLogin error:",e)}else try{var i,l;null===(l=window.clevertap)||void 0===l||null===(i=l.onUserLogin)||void 0===i||i.push({Site:r}),console.log("✅ Web CleverTap user login tracked:",e),await updateUserProfile(t||{})}catch(e){console.log("Web CleverTap onUserLogin error:",e)}},trackEvent=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r={...t,timestamp:new Date().toISOString(),platform:a.dV.isNativePlatform()?"mobile":"web"},i=new Promise((t,a)=>{try{if(isCleverTapAvailable())r&&Object.keys(r).length>0?n.z.recordEventWithNameAndProps(e,r):n.z.recordEventWithName(e);else{var o,i,l,c;r&&Object.keys(r).length>0?null===(i=window.clevertap)||void 0===i||null===(o=i.event)||void 0===o||o.push(e,r):null===(c=window.clevertap)||void 0===c||null===(l=c.event)||void 0===l||l.push(e)}t()}catch(e){a(e)}}),l=new Promise((e,t)=>{setTimeout(()=>t(Error("CleverTap event timeout")),3e3)});await Promise.race([i,l]),(0,o.WO)(e,r),console.log("✅ Event tracked: ".concat(e),r)}catch(e){console.error("Error tracking event:",e)}},trackProfileView=async e=>{await trackEvent("Profile Viewed",{"Viewed User ID":e})},trackSubscription=async(e,t,r)=>{await trackEvent("Subscription Purchased",{"Plan Name":e,Amount:t,Currency:r})},trackAppOpen=async()=>{try{(0,o.WO)("App Open")}catch(e){}if(isCleverTapAvailable())try{await n.z.notifyDeviceReady(),await n.z.recordEventWithName("App Open")}catch(e){console.log("CleverTap notifyDeviceReady/App Open error:",e)}else try{var e,t;null===(t=window.clevertap)||void 0===t||null===(e=t.event)||void 0===e||e.push("App Open")}catch(e){console.log("Web CleverTap App Open error:",e)}},trackScreenView=async e=>{await trackEvent("Screen View",{"Screen Name":e})}},4725:function(e,t,r){"use strict";r.d(t,{BP:function(){return initMixpanel},Bq:function(){return mixpanelPeopleSet},WO:function(){return mixpanelTrack},xU:function(){return mixpanelIdentify}});var n=r(718);let a=!1,getToken=()=>{let e="b19e0189e8c34fe2a980f09ba1ceeedc";return e&&e.trim().length>0?e.trim():"b19e0189e8c34fe2a980f09ba1ceeedc"},initMixpanel=e=>{if(a)return;let t=e||getToken();if(!t){console.warn("Mixpanel token missing. Set NEXT_PUBLIC_MIXPANEL_TOKEN in .env.local");return}n.Z.init(t,{debug:!0,track_pageview:!1}),a=!0,console.log("Mixpanel initialized")},mixpanelTrack=(e,t)=>{try{if(initMixpanel(),!a)return;t&&Object.keys(t).length>0?n.Z.track(e,t):n.Z.track(e)}catch(e){console.log("Mixpanel track error:",e)}},mixpanelIdentify=e=>{try{if(initMixpanel(),!a)return;n.Z.identify(e)}catch(e){console.log("Mixpanel identify error:",e)}},normalizePeopleProps=e=>{var t,r,n;let a={...e},o=null!==(t=e.Name)&&void 0!==t?t:e.name,i=null!==(r=e.Email)&&void 0!==r?r:e.email,l=null!==(n=e.Phone)&&void 0!==n?n:e.phone;return o&&(a.$name=String(o),delete a.Name,delete a.name),i&&(a.$email=String(i),delete a.Email,delete a.email),l&&(a.$phone=String(l),delete a.Phone,delete a.phone),a},mixpanelPeopleSet=e=>{try{if(initMixpanel(),!a)return;let t=normalizePeopleProps(e);n.Z.people.set(t)}catch(e){console.log("Mixpanel people.set error:",e)}}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),a=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var n,c={},s=null,d=null;for(n in void 0!==r&&(s=""+r),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(c[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===c[n]&&(c[n]=t[n]);return{$$typeof:a,type:e,key:s,ref:d,props:c,_owner:i.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[601,623,971,472,744],function(){return e(e.s=3634)}),_N_E=e.O()}]);