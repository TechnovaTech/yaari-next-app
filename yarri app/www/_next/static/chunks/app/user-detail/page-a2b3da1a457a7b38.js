(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[496],{3067:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});var a=l(2898);let t=(0,a.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6846:function(e,s,l){Promise.resolve().then(l.bind(l,1121))},1121:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return UserDetailPage}});var a=l(7437),t=l(4033),r=l(3067),n=l(7972),i=l(8339),c=l(2741),o=l(2265),d=l(3487),m=l(5650),u=l(5997),h=l(2606),x=l(5314),f=l(7115),g=l(5128);function UserDetailScreen(e){let{onBack:s,userId:l,onStartCall:p}=e,{lang:b}=(0,d.useLanguage)(),y=m.I[b],[j,N]=(0,o.useState)(null),[v,S]=(0,o.useState)(!0),[w,I]=(0,o.useState)("offline"),U=(0,t.useRouter)(),{socket:C}=(0,u.useSocket)(),[k,D]=(0,o.useState)(!1),[P,O]=(0,o.useState)(!1),[Z,A]=(0,o.useState)(!1),[z,_]=(0,o.useState)("video"),[E,J]=(0,o.useState)(null),[T,G]=(0,o.useState)(!1);(0,o.useEffect)(()=>{fetchUser(),(0,g.o$)("User Detail"),(0,g.YY)(l)},[l]),(0,o.useEffect)(()=>{if(!C)return;let handleUserStatusChange=e=>{let{userId:s,status:a}=e;s===l&&I("online"===a?"online":"offline")},handleOnlineUsers=e=>{let s=e.find(e=>e.userId===l);s&&I("online"===s.status?"online":"offline")};return C.on("online-users",handleOnlineUsers),C.on("user-status-change",handleUserStatusChange),C.emit("get-online-users"),C.on("call-accepted",e=>{let{channelName:s}=e;G(!1),sessionStorage.setItem("channelName",s);let l=sessionStorage.getItem("callData");if(l){let e=JSON.parse(l);setTimeout(()=>{U.push("video"===e.type?"/video-call":"/audio-call")},100)}}),C.on("call-declined",()=>{G(!1),sessionStorage.removeItem("callData"),alert("Call declined by user")}),C.on("call-ended",()=>{G(!1),sessionStorage.removeItem("callData"),U.push("/users")}),C.on("call-busy",e=>{let{message:s}=e;G(!1),sessionStorage.removeItem("callData"),alert(s)}),()=>{C.off("call-accepted"),C.off("call-declined"),C.off("call-ended"),C.off("call-busy"),C.off("online-users",handleOnlineUsers),C.off("user-status-change",handleUserStatusChange)}},[C,U]);let fetchUser=async()=>{try{let e=await fetch("https://admin.yaari.me/api/users/".concat(l)),s=await e.json();s.profilePic&&s.profilePic.includes("localhost")&&(s.profilePic=s.profilePic.replace(/https?:\/\/0\.0\.0\.0:\d+/,"https://admin.yaari.me")),s.gallery&&Array.isArray(s.gallery)&&(s.gallery=s.gallery.map(e=>e.includes("localhost")?e.replace(/https?:\/\/0\.0\.0\.0:\d+/,"https://admin.yaari.me"):e)),N(s)}catch(e){console.error("Error fetching user:",e)}finally{S(!1)}};if(v)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});if(!j)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-gray-500",children:"User not found"})});let handleCallClick=(e,s)=>{let a=(null==j?void 0:j.name)||"User",t=(null==j?void 0:j.profilePic)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(l),r=localStorage.getItem("mediaPermissionsGranted");J({userName:a,userAvatar:t,rate:s,type:e}),"true"===r?D(!0):(_(e),O(!0))},R=j.name||"User";return j.profilePic,(0,a.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("button",{onClick:s,children:(0,a.jsx)(r.Z,{size:24,className:"text-gray-800"})})}),(0,a.jsxs)("div",{className:"px-6 pb-32",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,a.jsxs)("div",{className:"relative mb-3",children:[(0,a.jsx)("div",{className:"w-32 h-32 bg-gray-300 rounded-full overflow-hidden flex items-center justify-center",children:j.profilePic?(0,a.jsx)("img",{src:j.profilePic,alt:"User",className:"w-full h-full object-cover"}):(0,a.jsx)(n.Z,{size:64,className:"text-gray-500"})}),(0,a.jsxs)("div",{className:"absolute top-2 -right-4 bg-white px-2 py-1 rounded-full flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("online"===w?"bg-green-500":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-xs font-medium ".concat("online"===w?"text-green-500":"text-gray-400"),children:"online"===w?y.online:y.offline})]})]}),(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:R})]}),j.about&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-primary font-semibold text-lg mb-2",children:y.aboutMe}),(0,a.jsx)("p",{className:"text-gray-700 text-sm leading-relaxed",children:j.about})]}),j.gallery&&j.gallery.length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-primary font-semibold text-lg mb-3",children:y.photoGallery}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:j.gallery.map((e,s)=>(0,a.jsx)("img",{src:e,alt:"Gallery ".concat(s),className:"aspect-square object-cover rounded-lg"},s))})]}),j.hobbies&&j.hobbies.length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-primary font-semibold text-lg mb-3",children:y.hobbies}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:j.hobbies.map((e,s)=>(0,a.jsx)("span",{className:"bg-orange-50 text-gray-800 px-4 py-2 rounded-lg text-sm border border-gray-200",children:e},s))})]})]}),(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white p-4 shadow-lg",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>handleCallClick("video",10),className:"flex-1 bg-primary text-white py-4 rounded-full font-semibold flex items-center justify-center gap-2",children:[(0,a.jsx)(i.Z,{size:18}),(0,a.jsxs)("span",{className:"flex items-center gap-0.5",style:{marginTop:"10px"},children:["10",(0,a.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-3 h-3 object-contain inline rounded-full border border-white mb-2.5"}),"/ min"]})]}),(0,a.jsxs)("button",{onClick:()=>handleCallClick("audio",5),className:"flex-1 bg-primary text-white py-4 rounded-full font-semibold flex items-center justify-center gap-2",children:[(0,a.jsx)(c.Z,{size:18}),(0,a.jsxs)("span",{className:"flex items-center gap-0.5",style:{marginTop:"10px"},children:["5",(0,a.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-3 h-3 object-contain inline rounded-full border border-white mb-2.5"}),"/ min"]})]})]})}),P&&(0,a.jsx)(x.Z,{type:z,onAllow:()=>{localStorage.setItem("mediaPermissionsGranted","true"),O(!1),D(!0)},onDeny:()=>{O(!1),J(null),A(!0)}}),Z&&(0,a.jsx)(f.Z,{onClose:()=>{A(!1),J(null)},onRetry:()=>{A(!1),O(!0)}}),k&&E&&(0,a.jsx)(h.Z,{onClose:()=>D(!1),onConfirm:()=>{if(!E||!C)return;D(!1),G(!0);let e=localStorage.getItem("user"),s=e?JSON.parse(e):null,a="call_".concat(Date.now());sessionStorage.setItem("callData",JSON.stringify({userName:E.userName,userAvatar:E.userAvatar,rate:E.rate,type:E.type,channelName:a,otherUserId:l})),C.emit("call-user",{callerId:null==s?void 0:s.id,callerName:(null==s?void 0:s.name)||"User",receiverId:l,callType:E.type,channelName:a})},userName:E.userName,callType:E.type,rate:E.rate,userAvatar:E.userAvatar}),T&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-primary rounded-full mx-auto mb-4 flex items-center justify-center animate-pulse",children:(0,a.jsx)(c.Z,{size:40,className:"text-white"})}),(0,a.jsx)("p",{className:"text-white text-xl",children:"Ringing..."}),(0,a.jsx)("button",{onClick:()=>{try{let e=sessionStorage.getItem("callData"),s=localStorage.getItem("user"),l=s?JSON.parse(s):null;if(C&&e&&(null==l?void 0:l.id)){let s=JSON.parse(e);(null==s?void 0:s.otherUserId)&&C.emit("end-call",{userId:l.id,otherUserId:s.otherUserId})}}catch(e){}G(!1),sessionStorage.removeItem("callData"),sessionStorage.removeItem("channelName")},className:"mt-6 px-4 py-2 bg-red-600 text-white rounded-lg",children:"Terminate Call"})]})})]})}function UserDetailPage(){let e=(0,t.useRouter)(),s=(0,t.useSearchParams)(),l=s.get("id")||"";return l?(0,a.jsx)(UserDetailScreen,{userId:l,onBack:()=>e.back(),onStartCall:s=>{sessionStorage.setItem("callData",JSON.stringify(s)),e.push("video"===s.type?"/video-call":"/audio-call")}}):(e.replace("/users"),null)}}},function(e){e.O(0,[601,623,952,617,753,971,472,744],function(){return e(e.s=6846)}),_N_E=e.O()}]);