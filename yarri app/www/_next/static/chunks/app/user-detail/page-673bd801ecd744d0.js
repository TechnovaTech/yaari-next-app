(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[496],{3067:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var l=t(2898);let a=(0,l.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5613:function(e,s,t){Promise.resolve().then(t.bind(t,1121))},1121:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return UserDetailPage}});var l=t(7437),a=t(4033),r=t(3067),n=t(7972),i=t(8339),c=t(2741),o=t(2265),d=t(3487),u=t(5650),m=t(5997),x=t(2606),h=t(5314),f=t(7115),g=t(5128);function UserDetailScreen(e){let{onBack:s,userId:t,onStartCall:p}=e,{lang:b}=(0,d.useLanguage)(),j=u.I[b],[y,N]=(0,o.useState)(null),[v,S]=(0,o.useState)(!0),[I,w]=(0,o.useState)("offline"),U=(0,a.useRouter)(),{socket:C}=(0,m.useSocket)(),[k,D]=(0,o.useState)(!1),[O,P]=(0,o.useState)(!1),[Z,z]=(0,o.useState)(!1),[_,A]=(0,o.useState)("video"),[E,J]=(0,o.useState)(null),[G,R]=(0,o.useState)(!1);(0,o.useEffect)(()=>{fetchUser(),(0,g.o$)("User Detail"),(0,g.YY)(t)},[t]),(0,o.useEffect)(()=>{if(!C)return;let handleUserStatusChange=e=>{let{userId:s,status:l}=e;s===t&&w("online"===l?"online":"offline")},handleOnlineUsers=e=>{let s=e.find(e=>e.userId===t);s&&w("online"===s.status?"online":"offline")};return C.on("online-users",handleOnlineUsers),C.on("user-status-change",handleUserStatusChange),C.emit("get-online-users"),C.on("call-accepted",e=>{let{channelName:s}=e;R(!1),sessionStorage.setItem("channelName",s);let t=sessionStorage.getItem("callData");if(t){let e=JSON.parse(t);setTimeout(()=>{U.push("video"===e.type?"/video-call":"/audio-call")},100)}}),C.on("call-declined",()=>{R(!1),sessionStorage.removeItem("callData"),alert("Call declined by user")}),C.on("call-ended",()=>{R(!1),sessionStorage.removeItem("callData"),U.push("/users")}),C.on("call-busy",e=>{let{message:s}=e;R(!1),sessionStorage.removeItem("callData"),alert(s)}),()=>{C.off("call-accepted"),C.off("call-declined"),C.off("call-ended"),C.off("call-busy"),C.off("online-users",handleOnlineUsers),C.off("user-status-change",handleUserStatusChange)}},[C,U]);let fetchUser=async()=>{try{let e=await fetch("https://acsgroup.cloud/api/users/".concat(t)),s=await e.json();N(s)}catch(e){console.error("Error fetching user:",e)}finally{S(!1)}};if(v)return(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});if(!y)return(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsx)("p",{className:"text-gray-500",children:"User not found"})});let handleCallClick=(e,s)=>{let l=(null==y?void 0:y.name)||"User",a=(null==y?void 0:y.profilePic)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(t),r=localStorage.getItem("mediaPermissionsGranted");J({userName:l,userAvatar:a,rate:s,type:e}),"true"===r?D(!0):(A(e),P(!0))},T=y.name||"User";return y.profilePic,(0,l.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)("button",{onClick:s,children:(0,l.jsx)(r.Z,{size:24,className:"text-gray-800"})})}),(0,l.jsxs)("div",{className:"px-6 pb-32",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,l.jsxs)("div",{className:"relative mb-3",children:[(0,l.jsx)("div",{className:"w-32 h-32 bg-gray-300 rounded-full overflow-hidden flex items-center justify-center",children:y.profilePic?(0,l.jsx)("img",{src:y.profilePic,alt:"User",className:"w-full h-full object-cover"}):(0,l.jsx)(n.Z,{size:64,className:"text-gray-500"})}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 bg-white px-2 py-1 rounded-full flex items-center space-x-1",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("online"===I?"bg-green-500":"bg-gray-400")}),(0,l.jsx)("span",{className:"text-xs font-medium ".concat("online"===I?"text-green-500":"text-gray-400"),children:"online"===I?j.online:j.offline})]})]}),(0,l.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:T}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:y.about||j.attributes})]}),y.about&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"text-primary font-semibold text-lg mb-2",children:j.aboutMe}),(0,l.jsx)("p",{className:"text-gray-700 text-sm leading-relaxed",children:y.about})]}),y.gallery&&y.gallery.length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"text-primary font-semibold text-lg mb-3",children:j.photoGallery}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-2",children:y.gallery.map((e,s)=>(0,l.jsx)("img",{src:e,alt:"Gallery ".concat(s),className:"aspect-square object-cover rounded-lg"},s))})]}),y.hobbies&&y.hobbies.length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"text-primary font-semibold text-lg mb-3",children:j.hobbies}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:y.hobbies.map((e,s)=>(0,l.jsx)("span",{className:"bg-orange-50 text-gray-800 px-4 py-2 rounded-lg text-sm border border-gray-200",children:e},s))})]})]}),(0,l.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white p-4 shadow-lg",children:(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsxs)("button",{onClick:()=>handleCallClick("video",10),className:"flex-1 bg-primary text-white py-4 rounded-full font-semibold flex items-center justify-center gap-2",children:[(0,l.jsx)(i.Z,{size:18}),(0,l.jsx)("span",{children:"₹10/min"})]}),(0,l.jsxs)("button",{onClick:()=>handleCallClick("audio",5),className:"flex-1 bg-primary text-white py-4 rounded-full font-semibold flex items-center justify-center gap-2",children:[(0,l.jsx)(c.Z,{size:18}),(0,l.jsx)("span",{children:"₹5/min"})]})]})}),O&&(0,l.jsx)(h.Z,{type:_,onAllow:()=>{localStorage.setItem("mediaPermissionsGranted","true"),P(!1),D(!0)},onDeny:()=>{P(!1),J(null),z(!0)}}),Z&&(0,l.jsx)(f.Z,{onClose:()=>{z(!1),J(null)},onRetry:()=>{z(!1),P(!0)}}),k&&E&&(0,l.jsx)(x.Z,{onClose:()=>D(!1),onConfirm:()=>{if(!E||!C)return;D(!1),R(!0);let e=localStorage.getItem("user"),s=e?JSON.parse(e):null,l="call_".concat(Date.now());sessionStorage.setItem("callData",JSON.stringify({userName:E.userName,userAvatar:E.userAvatar,rate:E.rate,type:E.type,channelName:l,otherUserId:t})),C.emit("call-user",{callerId:null==s?void 0:s.id,callerName:(null==s?void 0:s.name)||"User",receiverId:t,callType:E.type,channelName:l})},userName:E.userName,callType:E.type,rate:E.rate,userAvatar:E.userAvatar}),G&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-24 h-24 bg-primary rounded-full mx-auto mb-4 flex items-center justify-center animate-pulse",children:(0,l.jsx)(c.Z,{size:40,className:"text-white"})}),(0,l.jsx)("p",{className:"text-white text-xl",children:"Ringing..."}),(0,l.jsx)("button",{onClick:()=>{try{let e=sessionStorage.getItem("callData"),s=localStorage.getItem("user"),t=s?JSON.parse(s):null;if(C&&e&&(null==t?void 0:t.id)){let s=JSON.parse(e);(null==s?void 0:s.otherUserId)&&C.emit("end-call",{userId:t.id,otherUserId:s.otherUserId})}}catch(e){}R(!1),sessionStorage.removeItem("callData"),sessionStorage.removeItem("channelName")},className:"mt-6 px-4 py-2 bg-red-600 text-white rounded-lg",children:"Terminate Call"})]})})]})}function UserDetailPage(){let e=(0,a.useRouter)(),s=(0,a.useSearchParams)(),t=s.get("id")||"";return t?(0,l.jsx)(UserDetailScreen,{userId:t,onBack:()=>e.back(),onStartCall:s=>{sessionStorage.setItem("callData",JSON.stringify(s)),e.push("video"===s.type?"/video-call":"/audio-call")}}):(e.replace("/users"),null)}}},function(e){e.O(0,[952,189,971,472,744],function(){return e(e.s=5613)}),_N_E=e.O()}]);