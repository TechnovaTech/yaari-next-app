(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[449],{8942:function(e,t,a){Promise.resolve().then(a.bind(a,179))},179:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return CallHistoryPage}});var s=a(7437),l=a(4033),r=a(3487),i=a(5650),c=a(2265),n=a(5128);function CallHistoryScreen(e){let{onBack:t}=e,{lang:a}=(0,r.useLanguage)(),l=i.I[a],[o,d]=(0,c.useState)([]),[x,h]=(0,c.useState)(!0),[m,u]=(0,c.useState)(null);(0,c.useEffect)(()=>{(0,n.o$)("Call History"),fetchCallHistory()},[]);let fetchCallHistory=async()=>{try{let e=localStorage.getItem("user");if(!e){u("User not logged in"),h(!1);return}let t=JSON.parse(e);if(!t.id){u("User not logged in"),h(!1);return}let a=await fetch("/api/call-history?userId=".concat(t.id));if(!a.ok)throw Error("Failed to fetch call history");let s=await a.json();d(s)}catch(e){console.error("Error fetching call history:",e),u("Failed to load call history")}finally{h(!1)}},formatTime=e=>{let t=new Date(e);return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},formatDuration=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0")),getCallTypeIcon=(e,t)=>{let a=t?"text-green-500":"text-blue-500";return"video"===e?(0,s.jsx)("svg",{className:"w-4 h-4 ".concat(a),fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})}):(0,s.jsx)("svg",{className:"w-4 h-4 ".concat(a),fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})})};return(0,s.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,s.jsx)("div",{className:"flex items-center p-4 pt-8",children:(0,s.jsx)("button",{onClick:t,className:"mr-3",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}),(0,s.jsx)("div",{className:"px-4 pb-6",children:(0,s.jsx)("h1",{className:"text-3xl font-bold text-black",children:l.callHistoryTitle})}),(0,s.jsx)("div",{children:x?(0,s.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}):m?(0,s.jsxs)("div",{className:"px-4 py-8 text-center",children:[(0,s.jsx)("p",{className:"text-red-500 mb-4",children:m}),(0,s.jsx)("button",{onClick:fetchCallHistory,className:"bg-pink-500 text-white px-4 py-2 rounded-lg",children:"Retry"})]}):0===o.length?(0,s.jsxs)("div",{className:"px-4 py-8 text-center",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})}),(0,s.jsx)("p",{className:"text-gray-500 text-lg",children:"No call history yet"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Your call history will appear here"})]}):o.map(e=>(0,s.jsxs)("div",{className:"flex items-center px-4 py-4 border-b border-gray-100",children:[(0,s.jsx)("div",{className:"mr-4",children:(0,s.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden bg-gray-200",children:(0,s.jsx)("img",{src:e.otherUserAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e.otherUserName),alt:e.otherUserName,className:"w-full h-full object-cover"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[getCallTypeIcon(e.callType,e.isOutgoing),(0,s.jsx)("span",{className:"text-xs font-medium ".concat(e.isOutgoing?"text-green-500":"text-blue-500"),children:e.isOutgoing?"Outgoing":"Incoming"}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("completed"===e.status?"bg-green-100 text-green-800":"missed"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,s.jsx)("h3",{className:"font-semibold text-black text-lg",children:e.otherUserName}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.otherUserAbout})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-black font-medium",children:formatTime(e.startTime)}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.duration>0?formatDuration(e.duration):"--:--"}),e.cost>0&&(0,s.jsxs)("p",{className:"text-xs text-pink-500 font-medium",children:["â‚¹",e.cost.toFixed(2)]})]})]},e._id))})]})}function CallHistoryPage(){let e=(0,l.useRouter)();return(0,s.jsx)(CallHistoryScreen,{onBack:()=>e.back()})}}},function(e){e.O(0,[601,623,617,971,472,744],function(){return e(e.s=8942)}),_N_E=e.O()}]);