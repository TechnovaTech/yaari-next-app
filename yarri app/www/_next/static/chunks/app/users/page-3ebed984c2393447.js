(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{6274:function(e,t,s){Promise.resolve().then(s.bind(s,8867))},8867:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return UsersPage},dynamic:function(){return b}});var l=s(7437),a=s(4033),r=s(2898);let n=(0,r.Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);var i=s(7972),o=s(8339),c=s(2741),d=s(2265),u=s(2606),m=s(5314),h=s(7115),g=s(7015);function AdBanner(){let[e,t]=(0,d.useState)([]),[s,a]=(0,d.useState)(0),[r,n]=(0,d.useState)(!0),i=(0,d.useRef)(null),o=(0,d.useRef)(0),c=(0,d.useRef)(0),u=(0,d.useRef)(null);(0,d.useEffect)(()=>{fetchAds()},[]),(0,d.useEffect)(()=>{if(e.length>1){let t=e[s];(null==t?void 0:t.mediaType)==="photo"&&(u.current=setTimeout(()=>{a(t=>(t+1)%e.length)},5e3))}return()=>{u.current&&clearTimeout(u.current)}},[e.length,s]);let fetchAds=async()=>{try{let e=await fetch("".concat("https://admin.yaari.me","/api/ads")),s=await e.json();if(s.success&&s.ads.length>0){let e=s.ads.filter(e=>e.isActive).map(e=>({...e,imageUrl:e.imageUrl&&e.imageUrl.startsWith("/uploads/")?"https://admin.yaari.me".concat(e.imageUrl):e.imageUrl,videoUrl:e.videoUrl&&e.videoUrl.startsWith("/uploads/")?"https://admin.yaari.me".concat(e.videoUrl):e.videoUrl}));t(e)}}catch(e){console.error("Error fetching ads:",e)}finally{n(!1)}},handleAdClick=e=>{e.linkUrl&&window.open(e.linkUrl,"_blank","noopener,noreferrer")},goToPrevious=()=>{u.current&&clearTimeout(u.current),a(t=>0===t?e.length-1:t-1)},goToNext=()=>{u.current&&clearTimeout(u.current),a(t=>(t+1)%e.length)};if(r)return(0,l.jsx)("div",{className:"bg-gradient-to-br from-orange-100 to-orange-200 rounded-2xl h-40 mb-4 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})});if(0===e.length)return(0,l.jsx)("div",{className:"bg-gradient-to-br from-orange-100 to-orange-200 rounded-2xl h-40 mb-4 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center text-orange-700",children:[(0,l.jsx)("p",{className:"text-lg font-medium",children:"No ads available"}),(0,l.jsx)("p",{className:"text-sm opacity-75",children:"Check back later for updates"})]})});let m=e[s];return(0,l.jsxs)("div",{className:"relative rounded-2xl h-40 mb-4 overflow-hidden group",onTouchStart:e=>{o.current=e.targetTouches[0].clientX},onTouchMove:e=>{c.current=e.targetTouches[0].clientX},onTouchEnd:()=>{if(!o.current||!c.current)return;let t=o.current-c.current;t>50&&e.length>1&&goToNext(),t<-50&&e.length>1&&goToPrevious()},children:[(0,l.jsxs)("div",{className:"w-full h-full cursor-pointer",onClick:()=>handleAdClick(m),children:["photo"===m.mediaType?(0,l.jsx)("img",{src:m.imageUrl,alt:m.title,className:"w-full h-full object-cover",onError:e=>{var t;let s=e.target;s.style.display="none";let l=document.createElement("div");l.className="w-full h-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white font-bold",l.innerHTML='<div class="text-center"><p>Image not available</p><p class="text-sm opacity-75">'.concat(m.title,"</p></div>"),null===(t=s.parentNode)||void 0===t||t.appendChild(l)}}):(0,l.jsx)("video",{ref:i,className:"w-full h-full object-cover",src:m.videoUrl,autoPlay:!0,muted:!0,playsInline:!0,onEnded:()=>{e.length>1&&a(t=>(t+1)%e.length)},onError:e=>{var t;let s=e.target;s.style.display="none";let l=document.createElement("div");l.className="w-full h-full bg-gradient-to-br from-orange-400 to-orange-600",null===(t=s.parentNode)||void 0===t||t.appendChild(l)}}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-20"}),(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-end p-4 text-white",children:[(0,l.jsx)("h3",{className:"text-lg font-bold mb-1 drop-shadow-lg",children:m.title}),m.description&&(0,l.jsx)("p",{className:"text-sm opacity-90 drop-shadow-lg line-clamp-2",children:m.description})]})]}),m.linkUrl&&(0,l.jsx)("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs opacity-70",children:"Click to open"})]})}var f=s(3487),p=s(5650),x=s(5997),y=s(5128);function UserListScreen(e){let{onNext:t,onProfileClick:s,onCoinClick:r,onUserClick:b,onStartCall:v}=e,{lang:j}=(0,f.useLanguage)(),N=p.I[j],w=(0,a.useRouter)(),{socket:S}=(0,x.useSocket)(),[C,U]=(0,d.useState)(!1),[I,k]=(0,d.useState)(!1),[T,P]=(0,d.useState)(!1),[A,E]=(0,d.useState)("video"),[R,O]=(0,d.useState)(null),[D,J]=(0,d.useState)([]),[Z,_]=(0,d.useState)(!0),[L,z]=(0,d.useState)(0),[B,M]=(0,d.useState)(null),[H,W]=(0,d.useState)(!1),[V,F]=(0,d.useState)(!1),[G,X]=(0,d.useState)("all"),[Y,$]=(0,d.useState)(5),[q,K]=(0,d.useState)(10),[Q,ee]=(0,d.useState)(!1);(0,d.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);"male"===t.gender?X("female"):"female"===t.gender&&X("male")}fetchBalance(),fetchCallRates(),(0,y.o$)("User List")},[]);let fetchCallRates=async()=>{try{let e=await fetch("https://admin.yaari.me/api/settings"),t=await e.json();t.audioCallRate&&$(t.audioCallRate),t.videoCallRate&&K(t.videoCallRate)}catch(e){console.error("Error fetching call rates:",e)}};(0,d.useEffect)(()=>{if(!S)return;fetchUsers();let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);S.emit("user-online",{userId:t.id,status:"online"})}S.on("call-accepted",e=>{let{channelName:t}=e;console.log("Call accepted, navigating to call screen"),W(!1),sessionStorage.setItem("channelName",t);let s=sessionStorage.getItem("callData");if(s){let e=JSON.parse(s);setTimeout(()=>{w.push("video"===e.type?"/video-call":"/audio-call")},100)}}),S.on("call-declined",()=>{console.log("Call declined"),W(!1),sessionStorage.removeItem("callData"),alert("Call declined")}),S.on("call-ended",()=>{console.log("Call ended"),W(!1),sessionStorage.removeItem("callData"),w.push("/users")}),S.on("call-busy",e=>{let{message:t}=e;console.log("Call busy:",t),W(!1),sessionStorage.removeItem("callData"),alert(t)});let handleOnlineUsers=e=>{J(t=>t.map(t=>{let s=e.find(e=>e.userId===t.id);if(s){let e="online"===s.status?"bg-green-500":"busy"===s.status?"bg-yellow-500":"bg-gray-400";return{...t,status:s.status,statusColor:e}}return{...t,status:"offline",statusColor:"bg-gray-400"}}))},handleUserStatusChange=e=>{let{userId:t,status:s}=e;J(e=>e.map(e=>e.id===t?{...e,status:s,statusColor:"online"===s?"bg-green-500":"busy"===s?"bg-yellow-500":"bg-gray-400"}:e))};S.on("online-users",handleOnlineUsers),S.on("user-status-change",handleUserStatusChange),S.emit("get-online-users");let handleReconnect=()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);S.emit("user-online",{userId:t.id,status:"online"})}S.emit("get-online-users")};return S.on("connect",handleReconnect),()=>{S.off("call-accepted"),S.off("call-declined"),S.off("call-ended"),S.off("call-busy"),S.off("online-users",handleOnlineUsers),S.off("user-status-change",handleUserStatusChange),S.off("connect",handleReconnect)}},[S,R,w]);let fetchBalance=async()=>{try{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e),s=await fetch("https://admin.yaari.me/api/users/".concat(t.id,"/balance")),l=await s.json();s.ok&&z(l.balance||0)}}catch(e){console.error("Error fetching balance:",e)}},fetchUsers=async()=>{try{let e=localStorage.getItem("user"),t=e?JSON.parse(e).id:null,s=await fetch("https://admin.yaari.me/api/users-list"),l=await s.json(),a=l.filter(e=>e._id!==t).map(e=>{let t=e.profilePic;return t&&(t=t.replace(/https?:\/\/localhost:\d+/,"https://admin.yaari.me").replace(/https?:\/\/0\.0\.0\.0:\d+/,"https://admin.yaari.me")),(!t||t.includes("googleusercontent.com"))&&(t=t||null),{id:e._id,name:e.name||"User",attributes:e.about||"No description",status:"offline",statusColor:"bg-gray-400",profilePic:t,googleProfilePic:t&&t.includes("googleusercontent.com")?t:null,gender:e.gender,callAccess:e.callAccess||"full"}});J(a),S&&S.emit("get-online-users")}catch(e){console.error("Error fetching users:",e)}finally{_(!1)}},handleCallClick=async(e,t,s,l)=>{if(l.stopPropagation(),L<s){ee(!0);return}let a=localStorage.getItem("mediaPermissionsGranted");"true"===a?(O({user:e,type:t,rate:s}),U(!0)):(O({user:e,type:t,rate:s}),E(t),k(!0))};return(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white p-4 flex items-center justify-between shadow-sm",style:{paddingTop:"env(safe-area-inset-top)"},children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",style:{alignItems:"center"},children:[(0,l.jsx)(n,{className:"text-primary",size:24,fill:"#FF6B35",style:{marginTop:"4px"}}),(0,l.jsx)("h1",{className:"text-2xl font-bold text-primary mt-5",style:{lineHeight:"24px"},children:"Yaari"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)("button",{onClick:r,className:"flex items-center gap-2 border-2 border-orange-500 px-3 py-0 rounded-lg mt-2.5",style:{alignItems:"center"},children:[V?(0,l.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",style:{marginTop:"2px"},children:[(0,l.jsx)("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),(0,l.jsx)("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),(0,l.jsx)("path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z"})]}):(0,l.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-5 h-5 object-contain",style:{marginTop:"0px"},onError:()=>F(!0)}),(0,l.jsx)("span",{className:"text-gray-800 font-bold text-base mt-3",style:{lineHeight:"20px"},children:L})]}),(0,l.jsx)("button",{onClick:s,className:"w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center mt-2.5",children:(0,l.jsx)(i.Z,{className:"text-white",size:20})})]})]}),(0,l.jsxs)("div",{className:"p-4",style:{paddingTop:"calc(5rem + env(safe-area-inset-top))"},children:[(0,l.jsx)(AdBanner,{}),Z?(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"})}):0===D.length?(0,l.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No users found"}):(0,l.jsx)("div",{className:"space-y-3",children:D.filter(e=>"all"===G||e.gender===G).sort((e,t)=>{let s={online:0,busy:1,offline:2};return s[e.status]-s[t.status]}).map(e=>(0,l.jsxs)("div",{onClick:()=>{(0,y.L9)("Profile Viewed",{"Viewed User ID":e.id,Source:"User List","User Name":e.name,"User Status":e.status}),b(e.id)},className:"bg-white rounded-2xl p-4 flex items-center space-x-4 shadow-sm cursor-pointer active:bg-gray-50",children:[(0,l.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,l.jsx)("div",{className:"w-24 h-24 bg-gray-300 rounded-full overflow-hidden",children:e.profilePic?(0,l.jsx)("img",{src:e.profilePic,alt:"User",className:"w-full h-full object-cover"}):(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e.id),alt:"User",className:"w-full h-full object-cover"})}),(0,l.jsxs)("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 px-2 py-0.5 ".concat(e.statusColor," rounded-full text-white text-xs font-medium flex items-center space-x-1"),children:[(0,l.jsx)("div",{className:"w-1 h-1  bg-white rounded-full"}),(0,l.jsx)("span",{className:"capitalize mt-2.5",children:"online"===e.status?N.online:"offline"===e.status?N.offline:N.busy})]})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-primary font-bold text-lg mb-0.5",children:e.name}),(0,l.jsx)("p",{className:"text-gray-500 text-sm mb-3 line-clamp-1 overflow-hidden",children:e.attributes&&e.attributes.length>50?"".concat(e.attributes.slice(0,50),"......"):e.attributes}),"none"!==e.callAccess&&(0,l.jsxs)("div",{className:"flex gap-2",children:[("video"===e.callAccess||"full"===e.callAccess)&&(0,l.jsxs)("button",{onClick:t=>handleCallClick(e,"video",q,t),className:"flex-1 bg-primary text-white py-2 rounded-full flex items-center justify-center gap-1",style:{alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(o.Z,{size:16,fill:"white",strokeWidth:0}),(0,l.jsxs)("span",{className:"flex items-center gap-0.5 mt-2.5",children:[q,(0,l.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-3 h-3 object-contain inline rounded-full border border-white mb-2.5"}),"/ min"]})]}),("audio"===e.callAccess||"full"===e.callAccess)&&(0,l.jsxs)("button",{onClick:t=>handleCallClick(e,"audio",Y,t),className:"flex-1 bg-primary text-white py-2 rounded-full flex items-center justify-center gap-1",style:{alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(c.Z,{size:16,strokeWidth:2}),(0,l.jsxs)("span",{className:"flex items-center gap-0.5 mt-2.5",children:[Y,(0,l.jsx)("img",{src:"/images/coinicon.png",alt:"coin",className:"w-3 h-3 object-contain inline rounded-full border border-white mb-2.5"}),"/ min"]})]})]})]})]},e.id))})]}),I&&(0,l.jsx)(m.Z,{type:A,onAllow:()=>{localStorage.setItem("mediaPermissionsGranted","true"),k(!1),U(!0)},onDeny:()=>{k(!1),O(null)}}),T&&(0,l.jsx)(h.Z,{onClose:()=>{P(!1),O(null)},onRetry:()=>{P(!1),k(!0)}}),Q&&(0,l.jsx)(g.Z,{onClose:()=>ee(!1),onRecharge:()=>{ee(!1),r()}}),C&&R&&(0,l.jsx)(u.Z,{onClose:()=>U(!1),onConfirm:()=>{if(R&&S){U(!1),W(!0);let e=localStorage.getItem("user"),t=e?JSON.parse(e):null,s="call_".concat(Date.now());console.log("Calling user:",{callerId:null==t?void 0:t.id,callerName:null==t?void 0:t.name,receiverId:R.user.id,callType:R.type}),(0,y.L9)("Call Initiated",{"Call Type":R.type,"Receiver ID":R.user.id,Rate:R.rate,Source:"User List"}),sessionStorage.setItem("callData",JSON.stringify({userName:R.user.name,userAvatar:R.user.profilePic||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(R.user.id),rate:R.rate,type:R.type,channelName:s,otherUserId:R.user.id})),S.emit("call-user",{callerId:null==t?void 0:t.id,callerName:(null==t?void 0:t.name)||"User",receiverId:R.user.id,callType:R.type,channelName:s})}},userName:R.user.name,callType:R.type,rate:R.rate,userAvatar:R.user.profilePic||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(R.user.id)}),H&&R&&(0,l.jsx)("div",{className:"fixed inset-0 bg-gradient-to-b from-gray-900 to-black flex flex-col items-center justify-center z-50 p-6",children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsxs)("div",{className:"relative mb-8",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-primary rounded-full animate-ping opacity-20"}),(0,l.jsx)("div",{className:"relative w-32 h-32 bg-gray-300 rounded-full overflow-hidden border-4 border-primary",children:R.user.profilePic?(0,l.jsx)("img",{src:R.user.profilePic,alt:"User",className:"w-full h-full object-cover"}):(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(R.user.id),alt:"User",className:"w-full h-full object-cover"})})]}),(0,l.jsx)("h2",{className:"text-white text-2xl font-bold mb-2",children:R.user.name}),(0,l.jsx)("p",{className:"text-gray-400 text-lg mb-8",children:"Calling..."}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-12",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,l.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,l.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),(0,l.jsx)("button",{onClick:()=>{try{let e=sessionStorage.getItem("callData"),t=localStorage.getItem("user"),s=t?JSON.parse(t):null;if(S&&e&&(null==s?void 0:s.id)){let t=JSON.parse(e);(null==t?void 0:t.otherUserId)&&S.emit("end-call",{userId:s.id,otherUserId:t.otherUserId})}}catch(e){}W(!1),sessionStorage.removeItem("callData"),sessionStorage.removeItem("channelName")},className:"w-20 h-20 bg-red-600 rounded-full flex items-center justify-center shadow-lg hover:bg-red-700 transition",children:(0,l.jsx)(c.Z,{size:32,className:"text-white transform rotate-135",style:{transform:"rotate(135deg)"}})}),(0,l.jsx)("p",{className:"text-white text-sm mt-4",children:"End Call"})]})})]})}let b="force-static";function UsersPage(){let e=(0,a.useRouter)();return(0,l.jsx)(UserListScreen,{onNext:()=>e.push("/profile"),onProfileClick:()=>e.push("/profile"),onCoinClick:()=>e.push("/coins"),onUserClick:t=>e.push("/user-detail?id=".concat(t)),onStartCall:t=>{sessionStorage.setItem("callData",JSON.stringify(t)),e.push("video"===t.type?"/video-call":"/audio-call")}})}}},function(e){e.O(0,[601,623,952,617,161,971,472,744],function(){return e(e.s=6274)}),_N_E=e.O()}]);