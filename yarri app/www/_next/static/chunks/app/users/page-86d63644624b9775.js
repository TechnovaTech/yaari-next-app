(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{6274:function(e,t,s){Promise.resolve().then(s.bind(s,9377))},9377:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return UsersPage},dynamic:function(){return y}});var a=s(7437),l=s(4033),r=s(2898);let n=(0,r.Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);var i=s(7972),c=s(8339),o=s(2741),d=s(2265),u=s(2606),m=s(5314),h=s(7115),f=s(3487),g=s(5650),p=s(5997),x=s(5128);function UserListScreen(e){let{onNext:t,onProfileClick:s,onCoinClick:r,onUserClick:y,onStartCall:b}=e,{lang:v}=(0,f.useLanguage)(),j=g.I[v],N=(0,l.useRouter)(),{socket:S}=(0,p.useSocket)(),[C,w]=(0,d.useState)(!1),[I,U]=(0,d.useState)(!1),[k,P]=(0,d.useState)(!1),[O,D]=(0,d.useState)("video"),[T,Z]=(0,d.useState)(null),[R,_]=(0,d.useState)([]),[z,J]=(0,d.useState)(!0),[L,E]=(0,d.useState)(0),[A,B]=(0,d.useState)(null),[H,M]=(0,d.useState)(!1);(0,d.useEffect)(()=>{fetchUsers(),fetchBalance(),(0,x.o$)("User List")},[]),(0,d.useEffect)(()=>{if(!S)return;S.on("call-accepted",e=>{let{channelName:t}=e;console.log("Call accepted, navigating to call screen"),M(!1),sessionStorage.setItem("channelName",t);let s=sessionStorage.getItem("callData");if(s){let e=JSON.parse(s);setTimeout(()=>{N.push("video"===e.type?"/video-call":"/audio-call")},100)}}),S.on("call-declined",()=>{console.log("Call declined by receiver"),M(!1),sessionStorage.removeItem("callData"),alert("Call declined by user")}),S.on("call-ended",()=>{console.log("Call ended by other user"),M(!1),sessionStorage.removeItem("callData"),N.push("/users")}),S.on("call-busy",e=>{let{message:t}=e;console.log("Call busy:",t),M(!1),sessionStorage.removeItem("callData"),alert(t)});let handleOnlineUsers=e=>{_(t=>t.map(t=>{let s=e.find(e=>e.userId===t.id);if(s){let e="online"===s.status?"bg-green-500":"busy"===s.status?"bg-yellow-500":"bg-gray-400";return{...t,status:s.status,statusColor:e}}return{...t,status:"offline",statusColor:"bg-gray-400"}}))},handleUserStatusChange=e=>{let{userId:t,status:s}=e;_(e=>e.map(e=>e.id===t?{...e,status:s,statusColor:"online"===s?"bg-green-500":"busy"===s?"bg-yellow-500":"bg-gray-400"}:e))};S.on("online-users",handleOnlineUsers),S.on("user-status-change",handleUserStatusChange),S.emit("get-online-users");let handleReconnect=()=>S.emit("get-online-users");return S.on("connect",handleReconnect),()=>{S.off("call-accepted"),S.off("call-declined"),S.off("call-ended"),S.off("call-busy"),S.off("online-users",handleOnlineUsers),S.off("user-status-change",handleUserStatusChange),S.off("connect",handleReconnect)}},[S,T,N]);let fetchBalance=async()=>{try{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e),s=await fetch("https://acsgroup.cloud/api/users/".concat(t.id,"/balance")),a=await s.json();s.ok&&E(a.balance||0)}}catch(e){console.error("Error fetching balance:",e)}},fetchUsers=async()=>{try{let e=localStorage.getItem("user"),t=e?JSON.parse(e).id:null,s=await fetch("https://acsgroup.cloud/api/users"),a=await s.json(),l=a.filter(e=>e._id!==t).map(e=>{let t=e.profilePic;return(!t||t.includes("googleusercontent.com"))&&(t=t||null),{id:e._id,name:e.name||"User",attributes:e.about||"No description",status:"offline",statusColor:"bg-gray-400",profilePic:t,googleProfilePic:t&&t.includes("googleusercontent.com")?t:null}});_(l)}catch(e){console.error("Error fetching users:",e)}finally{J(!1)}},handleCallClick=async(e,t,s,a)=>{a.stopPropagation();let l=localStorage.getItem("mediaPermissionsGranted");"true"===l?(Z({user:e,type:t,rate:s}),w(!0)):(Z({user:e,type:t,rate:s}),D(t),U(!0))};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white p-4 flex items-center justify-between shadow-sm",style:{paddingTop:"env(safe-area-inset-top)"},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",style:{alignItems:"center"},children:[(0,a.jsx)(n,{className:"text-primary",size:24,fill:"#FF6B35",style:{marginTop:"4px"}}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-primary",style:{lineHeight:"24px"},children:"Yaari"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("button",{onClick:r,className:"flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-lg",style:{alignItems:"center"},children:[(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-gray-700",style:{marginTop:"2px"},children:[(0,a.jsx)("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),(0,a.jsx)("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),(0,a.jsx)("path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z"})]}),(0,a.jsxs)("span",{className:"text-gray-800 font-bold text-base",style:{lineHeight:"20px"},children:["â‚¹",L]})]}),(0,a.jsx)("button",{onClick:s,className:"w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center",children:(0,a.jsx)(i.Z,{className:"text-white",size:20})})]})]}),(0,a.jsxs)("div",{className:"p-4",style:{paddingTop:"calc(5rem + env(safe-area-inset-top))"},children:[(0,a.jsx)("div",{className:"bg-gradient-to-br from-orange-100 to-orange-200 rounded-2xl h-40 mb-4"}),z?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"})}):0===R.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No users found"}):(0,a.jsx)("div",{className:"space-y-3",children:R.sort((e,t)=>{let s={online:0,busy:1,offline:2};return s[e.status]-s[t.status]}).map(e=>(0,a.jsxs)("div",{onClick:()=>{(0,x.L9)("Profile Viewed",{"Viewed User ID":e.id,Source:"User List","User Name":e.name,"User Status":e.status}),y(e.id)},className:"bg-white rounded-2xl p-4 flex items-center space-x-4 shadow-sm cursor-pointer active:bg-gray-50",children:[(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-gray-300 rounded-full overflow-hidden",children:e.profilePic?(0,a.jsx)("img",{src:e.profilePic,alt:"User",className:"w-full h-full object-cover"}):(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e.id),alt:"User",className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 px-2 py-0.5 ".concat(e.statusColor," rounded-full text-white text-xs font-medium flex items-center space-x-1"),children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full"}),(0,a.jsx)("span",{className:"capitalize",children:"online"===e.status?j.online:"offline"===e.status?j.offline:j.busy})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-primary font-bold text-lg mb-0.5",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm mb-3 line-clamp-1 overflow-hidden",children:e.attributes&&e.attributes.length>50?"".concat(e.attributes.slice(0,50),"......"):e.attributes}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:t=>handleCallClick(e,"video",10,t),className:"flex-1 bg-primary text-white py-2 rounded-full flex items-center justify-center",style:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(c.Z,{size:16,fill:"white",strokeWidth:0})}),(0,a.jsx)("button",{onClick:t=>handleCallClick(e,"audio",5,t),className:"flex-1 bg-primary text-white py-2 rounded-full flex items-center justify-center",style:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(o.Z,{size:16,strokeWidth:2})})]})]})]},e.id))})]}),I&&(0,a.jsx)(m.Z,{type:O,onAllow:()=>{localStorage.setItem("mediaPermissionsGranted","true"),U(!1),w(!0)},onDeny:()=>{U(!1),Z(null)}}),k&&(0,a.jsx)(h.Z,{onClose:()=>{P(!1),Z(null)},onRetry:()=>{P(!1),U(!0)}}),C&&T&&(0,a.jsx)(u.Z,{onClose:()=>w(!1),onConfirm:()=>{if(T&&S){w(!1),M(!0);let e=localStorage.getItem("user"),t=e?JSON.parse(e):null,s="call_".concat(Date.now());console.log("Calling user:",{callerId:null==t?void 0:t.id,callerName:null==t?void 0:t.name,receiverId:T.user.id,callType:T.type}),(0,x.L9)("Call Initiated",{"Call Type":T.type,"Receiver ID":T.user.id,Rate:T.rate,Source:"User List"}),sessionStorage.setItem("callData",JSON.stringify({userName:T.user.name,userAvatar:T.user.profilePic||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(T.user.id),rate:T.rate,type:T.type,channelName:s,otherUserId:T.user.id})),S.emit("call-user",{callerId:null==t?void 0:t.id,callerName:(null==t?void 0:t.name)||"User",receiverId:T.user.id,callType:T.type,channelName:s})}},userName:T.user.name,callType:T.type,rate:T.rate,userAvatar:T.user.profilePic||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(T.user.id)}),H&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-primary rounded-full mx-auto mb-4 flex items-center justify-center animate-pulse",children:(0,a.jsx)(o.Z,{size:40,className:"text-white"})}),(0,a.jsx)("p",{className:"text-white text-xl",children:"Ringing..."}),(0,a.jsx)("button",{onClick:()=>{try{let e=sessionStorage.getItem("callData"),t=localStorage.getItem("user"),s=t?JSON.parse(t):null;if(S&&e&&(null==s?void 0:s.id)){let t=JSON.parse(e);(null==t?void 0:t.otherUserId)&&S.emit("end-call",{userId:s.id,otherUserId:t.otherUserId})}}catch(e){}M(!1),sessionStorage.removeItem("callData"),sessionStorage.removeItem("channelName")},className:"mt-6 px-4 py-2 bg-red-600 text-white rounded-lg",children:"Terminate Call"})]})})]})}let y="force-static";function UsersPage(){let e=(0,l.useRouter)();return(0,a.jsx)(UserListScreen,{onNext:()=>e.push("/profile"),onProfileClick:()=>e.push("/profile"),onCoinClick:()=>e.push("/coins"),onUserClick:t=>e.push("/user-detail?id=".concat(t)),onStartCall:t=>{sessionStorage.setItem("callData",JSON.stringify(t)),e.push("video"===t.type?"/video-call":"/audio-call")}})}}},function(e){e.O(0,[952,189,971,472,744],function(){return e(e.s=6274)}),_N_E=e.O()}]);