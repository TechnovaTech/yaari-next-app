(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{8425:function(e,t,r){Promise.resolve().then(r.bind(r,336))},336:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return OTPPage}});var n=r(7437),i=r(4033),o=r(2265),a=r(3103),l=r(5128);function OTPScreen(e){let{onNext:t}=e,[r,i]=(0,o.useState)(["","","","","",""]),[s,c]=(0,o.useState)(!1),[u,d]=(0,o.useState)(!1),[p,f]=(0,o.useState)(!1),[v,m]=(0,o.useState)(""),[h,y]=(0,o.useState)(30),[g,x]=(0,o.useState)(!1),P=(0,o.useRef)([]);(0,o.useEffect)(()=>{let e=localStorage.getItem("phone")||"";m(e),(0,l.o$)("OTP Verification")},[]),(0,o.useEffect)(()=>{if(h>0){let e=setTimeout(()=>y(h-1),1e3);return()=>clearTimeout(e)}x(!0)},[h]);let handleVerifyOTP=async()=>{let e=r.join("");if(6!==e.length){alert("Please enter complete OTP");return}if(!p){alert("Please confirm that you are 18+");return}c(!0);try{(0,l.L9)("OtpVerifyAttempt",{phone:v});let r=a.dV.isNativePlatform()?"".concat("https://admin.yaari.me","/api/auth/verify-otp"):"/api/auth/verify-otp",p=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v,otp:e})}),P=await p.json();if(p.ok){var n,i,o,s,u,f,m,h,y,g,x;d(!0),(0,l.L9)("OtpVerified",{phone:v}),localStorage.setItem("user",JSON.stringify(P.user));let e=(null===(n=P.user)||void 0===n?void 0:n.id)||(null===(i=P.user)||void 0===i?void 0:i._id)||v;await (0,l.QU)(e,{"Login Method":"OTP",Phone:v,Name:null===(o=P.user)||void 0===o?void 0:o.name,Email:null===(s=P.user)||void 0===s?void 0:s.email,Gender:null===(u=P.user)||void 0===u?void 0:u.gender,Age:null===(f=P.user)||void 0===f?void 0:f.age,City:null===(m=P.user)||void 0===m?void 0:m.city,"Profile Picture":null===(h=P.user)||void 0===h?void 0:h.profilePic,"Coins Balance":(null===(y=P.user)||void 0===y?void 0:y.coins)||0,"User Type":(null===(g=P.user)||void 0===g?void 0:g.isPremium)?"Premium":"Free","Account Created":null===(x=P.user)||void 0===x?void 0:x.createdAt}),P.user.name&&P.user.gender?window.location.href="/users":setTimeout(()=>t(),500)}else(0,l.L9)("OtpVerifyFailed",{phone:v,error:P.error}),alert(P.error||"Invalid OTP"),c(!1)}catch(e){(0,l.L9)("OtpVerifyError",{phone:v}),alert("Error verifying OTP"),c(!1)}},handleOtpChange=(e,t)=>{if(t.length<=1&&/^[0-9]*$/.test(t)){let o=[...r];if(o[e]=t,i(o),t&&e<5){var n;null===(n=P.current[e+1])||void 0===n||n.focus()}}},handleKeyDown=(e,t)=>{if("Backspace"===t.key&&!r[e]&&e>0){var n;null===(n=P.current[e-1])||void 0===n||n.focus()}},handleResendOTP=async()=>{if(g)try{let e=a.dV.isNativePlatform()?"".concat("https://admin.yaari.me","/api/auth/send-otp"):"/api/auth/send-otp",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v})});t.ok?(y(30),x(!1),i(["","","","","",""]),(0,l.L9)("OTP Resent",{phone:v}),alert("OTP sent successfully")):alert("Failed to resend OTP")}catch(e){alert("Error resending OTP")}};return(0,n.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center relative p-4",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(/images/loginScreenBackgroundImage.png)"}}),(0,n.jsxs)("div",{className:"relative z-10 bg-white rounded-3xl p-6 shadow-lg max-w-sm w-full",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-primary mb-2",children:"Enter OTP sent to"}),(0,n.jsxs)("p",{className:"text-gray-600 text-sm",children:["+91 ",v]})]}),(0,n.jsx)("div",{className:"flex justify-center space-x-2 mb-6",children:r.map((e,t)=>(0,n.jsx)("input",{ref:e=>{P.current[t]=e},type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:e=>handleOtpChange(t,e.target.value),onKeyDown:e=>handleKeyDown(t,e),className:"w-11 h-11 border-2 border-gray-300 rounded-lg text-center text-lg font-semibold focus:outline-none focus:border-primary bg-white"},t))}),(0,n.jsx)("button",{onClick:handleResendOTP,disabled:!g,className:"text-center text-sm w-full mb-4 ".concat(g?"text-primary cursor-pointer":"text-gray-400 cursor-not-allowed"),children:g?"Resend OTP":"Resend OTP in ".concat(h,"s")}),(0,n.jsxs)("button",{onClick:handleVerifyOTP,disabled:s||u,className:"w-full bg-primary text-white py-4 rounded-full font-semibold text-base mb-3 flex items-center justify-center relative overflow-hidden mt-2.5",children:[s&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("div",{className:"w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin"})}),u&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,n.jsx)("span",{className:s||u?"opacity-0":"opacity-100",children:"Verify & Continue"})]}),(0,n.jsxs)("button",{onClick:()=>{let e=!p;f(e),(0,l.L9)("AgeConfirmToggled",{confirmed:e})},className:"text-center text-xs text-gray-600 flex items-center justify-center w-full mb-3 mt-2.5",children:[(0,n.jsx)("span",{className:"inline-block w-4 h-4 rounded-sm mr-2 flex items-center justify-center text-white text-xs border-2 transition-colors ".concat(p?"bg-primary border-primary":"bg-white border-gray-300"),children:p&&(0,n.jsx)("span",{className:"mt-2.5",children:"✓"})}),"I Confirm I'm 18+"]})]})]})}function OTPPage(){let e=(0,i.useRouter)();return(0,n.jsx)(OTPScreen,{onNext:()=>e.push("/language")})}},5128:function(e,t,r){"use strict";r.d(t,{H4:function(){return trackAppOpen},L9:function(){return trackEvent},Lj:function(){return updateUserProfile},QU:function(){return trackUserLogin},Tf:function(){return trackSubscription},YY:function(){return trackProfileView},o$:function(){return trackScreenView}});var n=r(1007),i=r(3103),o=r(4725);let isNativeCleverTapReady=()=>{try{return i.dV.isNativePlatform()&&"function"==typeof(null===n.z||void 0===n.z?void 0:n.z.notifyDeviceReady)&&"function"==typeof(null===n.z||void 0===n.z?void 0:n.z.recordEventWithName)}catch(e){return!1}};(()=>{let e=!isNativeCleverTapReady();if(!e)return;let t=window;if(t.clevertap)return;t.clevertap={event:[],profile:[],account:[],onUserLogin:[],region:"eu1"},t.clevertap.account.push({id:"775-RZ7-W67Z"});let r=document.createElement("script");r.src="https://static.clevertap.com/js/clevertap.min.js",r.type="text/javascript",r.async=!0,r.onload=()=>console.log("CleverTap Web SDK loaded"),r.onerror=e=>console.error("CleverTap Web SDK load failed:",e);let n=document.getElementsByTagName("script")[0];((null==n?void 0:n.parentNode)||document.head).insertBefore(r,n||null)})(),(0,o.BP)();let isCleverTapAvailable=()=>isNativeCleverTapReady(),formatPhoneE164=e=>{if(!e)return;let t=String(e).trim();if(t.startsWith("+"))return t;let r=t.replace(/[^0-9]/g,"");return 10===r.length?"+91".concat(r):12===r.length&&r.startsWith("91")?"+".concat(r):void 0},updateUserProfile=async e=>{let t={...e},r=formatPhoneE164(e.Phone);r?t.Phone=r:delete t.Phone,t["MSG-push"]=!0,t["MSG-email"]=!0,t["MSG-sms"]=!0;try{(0,o.Bq)(t)}catch(e){}if(isCleverTapAvailable())try{await n.z.profileSet(t),console.log("✅ CleverTap profile updated:",t)}catch(e){console.log("CleverTap profileSet error:",e)}else try{var i,a;null===(a=window.clevertap)||void 0===a||null===(i=a.profile)||void 0===i||i.push({Site:t}),console.log("✅ Web CleverTap profile updated:",t)}catch(e){console.log("Web CleverTap profile push error:",e)}},trackUserLogin=async(e,t)=>{let r={Identity:e,...t||{}},i=formatPhoneE164(r.Phone);i?r.Phone=i:delete r.Phone,r["MSG-push"]=!0,r["MSG-email"]=!0,r["MSG-sms"]=!0;try{(0,o.xU)(e),r&&(0,o.Bq)(r)}catch(e){}if(isCleverTapAvailable())try{let i=n.z.onUserLogin(r),o=new Promise((e,t)=>{setTimeout(()=>t(Error("CleverTap login timeout")),5e3)});await Promise.race([i,o]),console.log("✅ CleverTap user login tracked:",e),await updateUserProfile(t||{})}catch(e){console.log("CleverTap onUserLogin error:",e)}else try{var a,l;null===(l=window.clevertap)||void 0===l||null===(a=l.onUserLogin)||void 0===a||a.push({Site:r}),console.log("✅ Web CleverTap user login tracked:",e),await updateUserProfile(t||{})}catch(e){console.log("Web CleverTap onUserLogin error:",e)}},trackEvent=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r={...t,timestamp:new Date().toISOString(),platform:i.dV.isNativePlatform()?"mobile":"web"},a=new Promise((t,i)=>{try{if(isCleverTapAvailable())r&&Object.keys(r).length>0?n.z.recordEventWithNameAndProps(e,r):n.z.recordEventWithName(e);else{var o,a,l,s;r&&Object.keys(r).length>0?null===(a=window.clevertap)||void 0===a||null===(o=a.event)||void 0===o||o.push(e,r):null===(s=window.clevertap)||void 0===s||null===(l=s.event)||void 0===l||l.push(e)}t()}catch(e){i(e)}}),l=new Promise((e,t)=>{setTimeout(()=>t(Error("CleverTap event timeout")),3e3)});await Promise.race([a,l]),(0,o.WO)(e,r),console.log("✅ Event tracked: ".concat(e),r)}catch(e){console.error("Error tracking event:",e)}},trackProfileView=async e=>{await trackEvent("Profile Viewed",{"Viewed User ID":e})},trackSubscription=async(e,t,r)=>{await trackEvent("Subscription Purchased",{"Plan Name":e,Amount:t,Currency:r})},trackAppOpen=async()=>{try{(0,o.WO)("App Open")}catch(e){}if(isCleverTapAvailable())try{await n.z.notifyDeviceReady(),await n.z.recordEventWithName("App Open")}catch(e){console.log("CleverTap notifyDeviceReady/App Open error:",e)}else try{var e,t;null===(t=window.clevertap)||void 0===t||null===(e=t.event)||void 0===e||e.push("App Open")}catch(e){console.log("Web CleverTap App Open error:",e)}},trackScreenView=async e=>{await trackEvent("Screen View",{"Screen Name":e})}},4725:function(e,t,r){"use strict";r.d(t,{BP:function(){return initMixpanel},Bq:function(){return mixpanelPeopleSet},WO:function(){return mixpanelTrack},xU:function(){return mixpanelIdentify}});var n=r(718);let i=!1,getToken=()=>{let e="b19e0189e8c34fe2a980f09ba1ceeedc";return e&&e.trim().length>0?e.trim():"b19e0189e8c34fe2a980f09ba1ceeedc"},initMixpanel=e=>{if(i)return;let t=e||getToken();if(!t){console.warn("Mixpanel token missing. Set NEXT_PUBLIC_MIXPANEL_TOKEN in .env.local");return}n.Z.init(t,{debug:!0,track_pageview:!1}),i=!0,console.log("Mixpanel initialized")},mixpanelTrack=(e,t)=>{try{if(initMixpanel(),!i)return;t&&Object.keys(t).length>0?n.Z.track(e,t):n.Z.track(e)}catch(e){console.log("Mixpanel track error:",e)}},mixpanelIdentify=e=>{try{if(initMixpanel(),!i)return;n.Z.identify(e)}catch(e){console.log("Mixpanel identify error:",e)}},normalizePeopleProps=e=>{var t,r,n;let i={...e},o=null!==(t=e.Name)&&void 0!==t?t:e.name,a=null!==(r=e.Email)&&void 0!==r?r:e.email,l=null!==(n=e.Phone)&&void 0!==n?n:e.phone;return o&&(i.$name=String(o),delete i.Name,delete i.name),a&&(i.$email=String(a),delete i.Email,delete i.email),l&&(i.$phone=String(l),delete i.Phone,delete i.phone),i},mixpanelPeopleSet=e=>{try{if(initMixpanel(),!i)return;let t=normalizePeopleProps(e);n.Z.people.set(t)}catch(e){console.log("Mixpanel people.set error:",e)}}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),i=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var n,s={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:a.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[601,623,971,472,744],function(){return e(e.s=8425)}),_N_E=e.O()}]);